var navigate={state:{},initState:function(){try{navigate.state={navigationModeExecute:[1052,1053,1054],isUndergroun:!1,isCollistionDetection:!1,isSlideMode:!1,isPresentationLoaded:!1,isPresentationToolboxOpen:!1,presentationID:null,homePosition:null,toolLastDiv:null,tabs:2,toolURLOpened:!1,toolsCount:0,tools:[{id:"homeBtn",name:""+Lang.navigate.home,title:""+Lang.navigate.flyHome,icon:"./images/icons/home.svg",action:"navigate.home()"},{id:"rotateBtn",name:""+Lang.navigate.rotate,title:""+Lang.navigate.flyAround,icon:"./images/icons/flyAround.svg",action:"navigate.flyAround()"},{id:"addLocationBtn",name:""+Lang.navigate.addLocation,title:""+Lang.navigate.addNewLocation,icon:"./images/icons/addLocation.svg",action:"navigate.createAndEditLocation(0,null)"},{id:"stopBtn",name:""+Lang.navigate.stop,title:""+Lang.navigate.stopFlight,icon:"./images/icons/stopFlight.svg",action:"navigate.stop()"}],last:null}}catch(err){application.errorHandling(err.message,0)}},init:function(){try{navigate.initState(),navigate.render(),navigate.state.tools.forEach(function(item){navigate.addNavigateTool(item)}),navigate.showTab(0),this.state.homePosition=SGWorld.Navigate.GetPosition(3);var locationArray,presentationID,startPositionStr=services.GetParamValue("position",""),startPresentationStr=(""!=startPositionStr&&(7==(locationArray=startPositionStr.split(",")).length&&locationArray.splice(2,0,0),locationArray[3]||(locationArray[2]=500),locationArray[4]||(locationArray[3]=0),locationArray[5]||(locationArray[4]=-60),locationArray[6]||(locationArray[5]="Start Position"),locationArray[6]=decodeURIComponent(locationArray[6]),locationArray[7]||(locationArray[6]=0),this.state.homePosition=this.createLocation(1,locationArray,!0).Position,SGWorld.Navigate.FlyTo(this.state.homePosition,14)),decodeURI(services.GetParamValue("presentation",""))),startPresentationAutoPlay=services.GetParamValue("presentationPlay","");$("#presentationIframe").on("load",function(){""!=startPresentationStr&&(""!=(presentationID=SGWorld.ProjectTree.FindItem(startPresentationStr))&&navigate.PlayObject(presentationID,"1"==startPresentationAutoPlay),startPresentationStr="")}),$("#presentationIframe").attr("src","./tools/presentation/PresentationControlPanel.html?lang="+Lang.code),SGWorld.AttachEvent("OnPresentationEvent",navigate.OnPresentationEvent),$("#fiedOfViewSlider").val(53)}catch(err){application.errorHandling(err.message,0)}},render:function(tabIndex){try{$("body").append(`
            <div id="navigateMain" class="panelContent" style="display:none">
                <div class="grid2 tabs">
                    <div class="gridCenter tab  " id="navigateTabButton0" onclick="navigate.showTab(0)">${Lang.navigate.tools} </div>
                    <div class="gridCenter tab  " id="navigateTabButton1" onclick="navigate.showTab(1)">${Lang.navigate.modes} </div>
                </div>
                
                <div id="navigateTab0" > 
                    <div id="navigateToolsDiv" class="grid3 gridCenter spacerAbove"> </div>

                    <div class="grid3 gridPadding spacerAbove">
                        <div class="gridDouble propertiesTitle">${Lang.navigate.fieldOfView}</div>
                        <div class='gridRight'>
                            <span id="fiedOfViewText">53</span> <span>Â°</span> 
                            <button id="resetFOV" class=" " onclick="navigate.setFOV(53)">${Lang.navigate.reset} </button>
                        </div>
                        <div  class="gridTriple gridSlider">  
                            <input type="range" id="fiedOfViewSlider" oninput="navigate.setFieldOfView (this.value)" min="30" max="120" > </input></div>
                    </div>
                </div>
                    
                <div id="navigateTab1" class="grid3 gridPadding gridCenter"> 
                    <div id="renderModesHeader" class="gridTriple propertiesTitle">${Lang.navigate.renderModes} </div>
                    <div id="renderModes" class="gridTriple"> 
                        <button id="navigateMode0" class=" ButtonChecked " onclick="navigate.navigateMode(0)" title="${Lang.navigate.threeDModel}">${Lang.navigate.threeD}</button>
                        <button id="navigateMode1" class=" " onclick="navigate.navigateMode(1)" title="${Lang.navigate.twoDMode}">${Lang.navigate.towD}</button>
                        <button id="navigateMode2" class=" " onclick="navigate.navigateMode(2)" title="${Lang.navigate.twoDNorthMode}">${Lang.navigate.twoDNorth}</button>
                    </div>
                    
                    <div id="navigationButtonsHeader" class="gridTriple propertiesTitle">${Lang.navigate.navigationModes} </div>
                    <div id="undergroundBtnDiv"> <button id="undergroundBtn" class=" ButtonLarge " onclick="navigate.undergroundMode()" title="${Lang.navigate.undergroundMode}"><img src="images/icons/underground.svg"> <br><span>${Lang.navigate.undergroundModeBtn}</span></button></div>
                    <div id="collisionBtnDiv"> <button id="collisionBtn" class=" ButtonLarge " onclick="navigate.collisionDetection()" title="${Lang.navigate.collisionDetection}"><img src="images/icons/collisionDetection.svg"><br><span>${Lang.navigate.cllisionDetectionBtn}</span></button></div>
                    <div id="slideModeBtnDiv"> <button id="slideModeBtn" class=" ButtonLarge " onclick="navigate.slideMode()" title="${Lang.navigate.slideMode}"><img src="images/icons/slideMode.svg"><br><span>${Lang.navigate.slideModeBtn}</span></button></div>
                </div>

            </div>
            
        <div id='shareLocation' class='grid1 gridPadding  '> 
            <div class=' propertiesTitle'> ${Lang.navigate.shareLocationHeader} </div>
            <div class=''> <input type='text' class='w100' id='sharedLocationText' value=''/> </div>
            <div class=' gridCenter'>      
            <button id='sharedLocationCopy' class=' ButtonLarge ' onclick='navigate.copyShareLink(0);'><img src='images/icons/link.svg'><br><span>${Lang.navigate.copyLink}</span></button>
            <button id='sharedLocationEmail' class=' ButtonLarge ' onclick='navigate.copyShareLink(1);'><img src='images/icons/email.svg'><br><span>${Lang.navigate.shareEmail}</span></button>
            <button id='sharedLocationWhatsApp' class=' ButtonLarge ' onclick='navigate.copyShareLink(2);'><img src='images/icons/WhatsApp.svg'><br><span>${Lang.navigate.shareWhatsApp}</span></button>
            <button id='sharedLocationTwitter' class=' ButtonLarge ' onclick='navigate.copyShareLink(3);'><img src='images/icons/Twitter.svg'><br><span>${Lang.navigate.shareTwitter}</span></button>
            </div>
        </div>

        <div id="presentationPanel"  title="" style="display:none; padding:0rem"></div>
        <iframe type="text/html" id="presentationIframe" class="presentationContent" src="" style="display:none;"></iframe>
          `)}catch(err){application.errorHandling(err.message,0)}},onShow:function(){try{navigate.setFOV(SGWorld.Navigate.FieldOfView)}catch(err){application.errorHandling(err.message,0)}},showTab:function(tabIndex){try{for(var i=0;i<navigate.state.tabs;i++)i==tabIndex?($("#navigateTab"+i).show(),$("#navigateTab"+i).css("opacity","1"),$("#navigateTabButton"+i).addClass("tabSelected")):($("#navigateTab"+i).hide(),$("#navigateTab"+i).css("opacity","0"),$("#navigateTabButton"+i).removeClass("tabSelected"))}catch(err){application.errorHandling(err.message,0)}},addNavigateTool:function(item){try{navigate.state.toolsCount++;var button=$(`<div id="${item.id}Div"><button id="${item.id}" class=" inlineBlock ButtonLarge " onclick="${item.action}" title="${item.title}"><img src="${item.icon}"><br><span>${item.name}</span></button></div>`);$("#navigateToolsDiv").append(button)}catch(err){application.errorHandling(err.message,0)}},openNavigateToolURL:function(url,toolName,backButton,width,height){try{null==backButton&&(backButton=!0);url=url+"?lang="+Lang.code+"&root="+projectTree.getMyDataGroup();panel.addAndShow(1,url,toolName,analysis.closeAnalysisTool,width,height,!backButton,0),navigate.state.toolURLOpened=!0}catch(err){application.errorHandling(err.message,0)}},home:function(){try{SGWorld.Navigate.FlyTo(this.state.homePosition,0)}catch(err){application.errorHandling(err.message,0)}},zoom:function(direction){try{1==direction?SGWorld.Navigate.ZoomIn():SGWorld.Navigate.ZoomOut()}catch(err){application.errorHandling(err.message,0)}},north:function(){try{application.execute(1056,0)}catch(err){application.errorHandling(err.message,0)}},navigateMode:function(mode){try{for(i=0;i<3;i++)services.highlightButton("navigateMode"+i,!1);services.highlightButton("navigateMode"+mode,!0),application.execute(this.state.navigationModeExecute[mode],0)}catch(err){application.errorHandling(err.message,0)}},undergroundMode:function(){try{this.isUndergroun=!this.isUndergroun,services.highlightButton("undergroundBtn",this.isUndergroun),application.execute(1027,0)}catch(err){application.errorHandling(err.message,0)}},collisionDetection:function(){try{this.isCollistionDetection=!this.isCollistionDetection,services.highlightButton("collisionBtn",this.isCollistionDetection),application.execute(1140,0)}catch(err){application.errorHandling(err.message,0)}},slideMode:function(){try{this.isSlideMode=!this.isSlideMode,services.highlightButton("slideModeBtn",this.isSlideMode),application.execute(1050,0)}catch(err){application.errorHandling(err.message,0)}},flyAround:function(){try{application.execute(1057,0)}catch(err){application.errorHandling(err.message,0)}},flyToCoord:function(x,y){try{var camera=SGWorld.Navigate.GetPosition(0),pos=SGWorld.Creator.CreatePosition(x,y,0,0,camera.Yaw,-75,0,200);SGWorld.Navigate.FlyTo(pos,0)}catch(err){application.errorHandling(err.message,0)}},FlyToFeatureDataSourceFeatureID:function(features,dataSourceID,flightType){try{var feature=features.GetFeatureByDataSourceFeatureID(dataSourceID);SGWorld.Navigate.FlyTo(feature.ID,flightType)}catch(err){application.errorHandling(err.message,0)}},createAndEditLocation:function(type,pos){try{var location=navigate.createLocation(type,pos,!1);projectTree.openPropertiesSheet(location.ID,""+Lang.navigate.addNewLocation,"projectTree.state.style"),application.showMessageBar(Lang.navigate.locationAdded,5,2)}catch(err){application.errorHandling(err.message,0)}},createLocation:function(type,pos,fromURL){try{var group=fromURL?SGWorld.ProjectTree.RootID:projectTree.getMyDataGroup(),actionCode=0;if(null!=pos)1==type?(locationPosition=SGWorld.Creator.CreatePosition(pos[0],pos[1],pos[2],3,pos[4],pos[5],0,pos[3]),name=pos[6],actionCode=pos[7]):2==type&&(locationPosition=pos.Copy());else{var name=""+Lang.navigate.myLocation,locationPosition=SGWorld.Window.PixelToWorld(SGWorld.Window.Rect.Width/2,SGWorld.Window.Rect.Height/2,-1153).Position,camera=SGWorld.Navigate.GetPosition(3);if(0==locationPosition.X&&0==locationPosition.Y)return null;camera=camera.AimTo(locationPosition),locationPosition.Distance=locationPosition.DistanceTo(camera),locationPosition.Pitch=camera.Pitch,locationPosition.Yaw=camera.Yaw}var location=SGWorld.Creator.CreateLocation(locationPosition,group,name);return location.Action.Code=actionCode,location}catch(err){application.errorHandling(err.message,0)}},shareLocation(itemID){try{var object=SGWorld.Creator.GetObject(itemID),URL=document.location.href;-1!=URL.indexOf("&")&&(URL=URL.substring(0,URL.indexOf("&"))),URL+=`&position=${object.Position.X.toFixed(6)},${object.Position.Y.toFixed(6)},${object.Position.Altitude.toFixed(2)},${object.Position.Distance.toFixed(2)},${object.Position.Yaw.toFixed(2)},${object.Position.Pitch.toFixed(2)},${object.TreeItem.Name},`+object.Action.Code,$("#sharedLocationText").val(URL);panel.addAndShow(0,"shareLocation",Lang.navigate.shareLocation,null,panel.state.widthXLarge,panel.state.heightMedium,!1,0)}catch(err){application.errorHandling(err.message,0)}},copyLocationCoord(itemID){try{var LonSign,LatSign,locationObject=SGWorld.Creator.GetObject(itemID),textarea=document.createElement("textarea");SGWorld.Terrain.CoordinateSystem.IsPlanar()?(LonSign="E",LatSign="N",textarea.value=`${locationObject.Position.X.toFixed(2)} ${LonSign} , ${locationObject.Position.Y.toFixed(2)} ${LatSign} `):(LonSign=0<=locationObject.Position.X?"E":"W",LatSign=0<=locationObject.Position.Y?"N":"S",textarea.value=`${Math.abs(locationObject.Position.X).toFixed(7)} ${LonSign} , ${Math.abs(locationObject.Position.Y).toFixed(7)} ${LatSign} `),document.body.appendChild(textarea),textarea.select(),document.execCommand("copy"),document.body.removeChild(textarea),application.showMessageBar(Lang.projectTree.copyCoordMessage,5,2)}catch(err){application.errorHandling(err.message,0)}},copyShareLink:function(type){try{var bodyText=encodeURIComponent($("#sharedLocationText").val().replace(/ /g,"%20"));switch(type){case 0:services.copyToClipboard($("#sharedLocationText").val());break;case 1:var mailtoLink=`mailto:?subject=${Lang.navigate.shareLocationEmailSubject}&body=`+bodyText;window.location.href=mailtoLink;break;case 2:window.open(`https://api.whatsapp.com/send/?text=${bodyText}&type=custom_url&app_absent=0`,"_blank");break;case 3:window.open("https://twitter.com/intent/tweet?text=="+bodyText,"_blank")}panel.back()}catch(err){application.errorHandling(err.message,0)}},stop:function(){try{SGWorld.Navigate.Stop(),navigate.hidePresentation()}catch(err){application.errorHandling(err.message,0)}},setFieldOfView:function(sliderVal){try{var fov=sliderVal;SGWorld.Navigate.FieldOfView=fov,$("#fiedOfViewText").text(fov)}catch(err){application.errorHandling(err.message,0)}},setFOV:function(fov){try{fov=Math.round(fov),$("#fiedOfViewSlider").val(fov),this.setFieldOfView(fov)}catch(err){application.errorHandling(err.message,0)}},showPresentation:function(){try{navigate.state.isPresentationToolboxOpen||(panel.addAndShow(0,"presentationPanel",SGWorld.ProjectTree.GetItemName(navigate.state.presentationID),navigate.hidePresentation,panel.state.widthMedium,"16rem",!1,0),setTimeout(()=>{var panelOffset=$("#presentationPanel").offset(),pixelUnit=parseFloat(getComputedStyle(document.documentElement).fontSize);$("#presentationIframe").css({top:panelOffset.top+ +pixelUnit+"px",left:panelOffset.left+ +pixelUnit+"px"}),$("#presentationIframe").show(),navigate.state.isPresentationToolboxOpen=!0},500))}catch(err){application.errorHandling(err.message,0)}},hidePresentation:function(){try{navigate.state.isPresentationToolboxOpen&&null!=navigate.state.presentationID&&(SGWorld.Creator.GetObject(navigate.state.presentationID).Stop(),navigate.state.presentationID=null,navigate.state.isPresentationToolboxOpen=!1,$("#presentationIframe").hide())}catch(err){application.errorHandling(err.message,0)}},OnPresentationEvent:function(eventParameters){try{var params=JSON.parse(eventParameters);"StatusChanged"!=params.eventName||"Playing"!=params.newStatus||navigate.state.isPresentationToolboxOpen||(navigate.state.presentationID=params.presentationId,navigate.showPresentation())}catch(err){application.errorHandling(err.message,0)}},PlayObject:function(itemID,autoplay){var object=null,objectType=-1,action=-1;try{objectType=(object=SGWorld.Creator.GetObject(itemID)).ObjectType,action=object.Action.Code}catch{}try{SGWorld.ProjectTree.SelectItem(itemID,0,0),34==objectType?(navigate.state.presentationID=itemID,autoplay?SGWorld.Creator.GetObject(navigate.state.presentationID).Play():navigate.showPresentation()):20==objectType?object.Message.Activate():(application.state.isMobile&&panel.close(),-1!=action?SGWorld.Navigate.FlyTo(itemID,object.Action.Code):SGWorld.Navigate.FlyTo(itemID))}catch(err){application.errorHandling(err.message,0)}},dummy:null};