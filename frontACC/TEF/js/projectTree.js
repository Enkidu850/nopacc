var projectTree={state:{},initState:function(){try{projectTree.state={treeDivName:"",myDataDivName:"",treeState:-1,treeItemIcons:{folder:"InfotreeGroupOp.svg",object:"InfotreeObjectStatic.svg",_18:"InfotreeLabel.svg",_19:"InfotreeLocation.svg",_20:"InfotreeHotlink.svg",_23:"InfotreeObjectDyn.svg",_24:"InfotreeLabel.svg",_26:"InfotreeImageryLayer.svg",_27:"InfotreeVideo.svg",_28:"infoTreePointCloud.svg",_29:"InfotreeRasterLayer.svg",_30:"infoTreeModifyTerrain.svg",_34:"InfotreePresentation.svg",_35:"InfotreeLOS2.svg",_36:"InfotreeMPV.svg",_36_0:"LayerPointInfoTree.svg",_36_1:"LayerPolylineInfoTree.svg",_36_2:"LayerPolygonInfoTree.svg",_36_3:"InfotreeMPV.svg",_37:"InfotreeMPV.svg",_38:"InfoTree3DMLMeshLayer.svg",_40:"InfotreeKML.svg",_41:"Infotree3DViewshed.svg",_42:"infotreeContour.svg",_43:"InfotreeSlope.svg",_44:"InfotreeLabel.svg",_45:"InfotreeNetworkLink.svg"},treeIconSize:"1.3rem",treeItemsWithoutCheckbox:[19,20,21,22,32,34,45,46],treeItemsLayers:[26,28,29,36,38],treeItemsKML:[40],treeItemsNavigate:[19,21,34],treeFilterText:["navigate","layers","tree"],deleteAllText:[""+Lang.projectTree.deleteAllLocations,""+Lang.projectTree.deleteAllLayers,""+Lang.projectTree.deleteAll],inLoadMyData:!1,myDataGroupID:"",myDataGroupName:"MyData",myDrawingObjectsGroup:null,findMyData:!1,toolLastDiv:null,PSIndex:0,PSDiv:null,inEditGeometry:!1,editGeometryBtn:null,editGeometryTypes:[1,2,18,24,41],toolsURL:{ClipModel:"./Tools/ImageComparison/BimComparisonPopup.html"},geometryTypes:["Point","Polyline","Polygon","Point"],defaultValues:{"LineStyle.Color":null,"LineStyle.Width":-2,"FillStyle.Color":null,"Style.FontSize":16,"Style.TextColor":null,ImageFileName:null},attributesList:[],style:{typeGroup:{properties:[{name:""+Lang.projectTree.description,type:"description"}]},type19:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.activationAction,type:"list",list:[{name:""+Lang.projectTree.flyTo,value:0},{name:""+Lang.projectTree.jumpTo,value:14}],property:"Action.Code"}],buttons:[{name:""+Lang.projectTree.share,icon:"share.svg",callback:ID=>{navigate.shareLocation(ID)},buttonType:0},{name:""+Lang.projectTree.coordinate,icon:"copy.svg",callback:ID=>{navigate.copyLocationCoord(ID)},buttonType:0,title:""+Lang.projectTree.copyCoord}]},type26:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.removeNullValue,type:"list",property:"UseNull",list:[{name:""+Lang.projectTree.yes,value:1},{name:""+Lang.projectTree.no,value:0}]},{name:""+Lang.projectTree.nullValue,type:"color",property:"NullValue"},{name:""+Lang.projectTree.nullTolerance,type:"range",property:"NullTolerance",min:"0",max:"255"}]},type28:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.pointSize,type:"range",property:"PointSize",min:"1",max:"10"},{name:""+Lang.projectTree.pointColor,type:"color",property:"PointColor"},{name:""+Lang.projectTree.intensityBlend,type:"range",property:"IntensityBlend",min:"1",max:"100",factor:100},{name:""+Lang.projectTree.flattenTerrain,type:"list",property:"FlattenBelowTerrain",list:[{name:""+Lang.projectTree.yes,value:1},{name:""+Lang.projectTree.no,value:0}]},{name:""+Lang.projectTree.altitudeMethod,type:"list",property:"AltitudeType",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"}]},type29:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.removeNullValue,type:"list",property:"UseNull",list:[{name:""+Lang.projectTree.yes,value:1},{name:""+Lang.projectTree.no,value:0}]},{name:""+Lang.projectTree.nullValue,type:"number",property:"NullValue"},{name:""+Lang.projectTree.nullTolerance,type:"number",property:"NullTolerance"}]},type36_Point:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.text,type:"text",classification:"Text",attributesAutoComplete:!0},{name:""+Lang.projectTree.textColor,type:"color",classification:"Text Color"},{name:""+Lang.projectTree.icon,type:"text",classification:"Image file"},{name:""+Lang.projectTree.iconColor,type:"color",classification:"Image Color"},{name:""+Lang.projectTree.visibilityDistance,type:"range",classification:"Scale",min:"0.2",max:"30",factor:"POW2"},{name:""+Lang.projectTree.altitudeMethod,type:"list",classification:"Altitude Method",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.relativeToModel,value:14}]},{name:""+Lang.projectTree.altitudeOffset,type:"number",classification:"Altitude",factor:"feet"},{name:""+Lang.projectTree.lineToGround,type:"list",classification:"Line To Ground",list:[{name:""+Lang.projectTree.no,value:0},{name:""+Lang.projectTree.yes,value:1}]},{name:""+Lang.projectTree.tooltip,type:"text",classification:"Tool Tip",attributesAutoComplete:!0},{name:""+Lang.projectTree.message,type:"message",classification:"Message",attributesAutoComplete:!0}]},type36_Polyline:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.lineWidth,type:"range",classification:"Line Width",min:"0",max:"5",factor:-1},{name:""+Lang.projectTree.lineColor,type:"color",classification:"Line Color"},{name:""+Lang.projectTree.lineOpacity,type:"range",classification:"Line Opacity",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.altitudeMethod,type:"list",classification:"Altitude Method",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitudeOffset,type:"number",classification:"Altitude",factor:"feet"},{name:""+Lang.projectTree.visibilityDistance,type:"range",classification:"Max. Visibility Distance",min:"10",max:"2000",factor:"POW2"},{name:""+Lang.projectTree.tooltip,type:"text",classification:"Tool Tip",attributesAutoComplete:!0},{name:""+Lang.projectTree.message,type:"message",classification:"Message",attributesAutoComplete:!0}]},type36_Polygon:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.lineWidth,type:"range",classification:"Line Width",min:"0",max:"5",factor:-1},{name:""+Lang.projectTree.lineColor,type:"color",classification:"Line Color"},{name:""+Lang.projectTree.lineOpacity,type:"range",classification:"Line Opacity",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.fillColor,type:"color",classification:"Fill Color"},{name:""+Lang.projectTree.fillOpacity,type:"range",classification:"Fill Opacity",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.altitudeMethod,type:"list",classification:"Altitude Method",list:[{name:""+Lang.projectTree.relative,value:10},{name:""+Lang.projectTree.absolute,value:11},{name:""+Lang.projectTree.onTerrain,value:12}]},{name:""+Lang.projectTree.altitudeOffset,type:"number",classification:"Altitude",factor:"feet"},{name:""+Lang.projectTree.visibilityDistance,type:"range",classification:"Max. Visibility Distance",min:"10",max:"2000",factor:"POW2"},{name:""+Lang.projectTree.tooltip,type:"text",classification:"Tool Tip",attributesAutoComplete:!0},{name:""+Lang.projectTree.message,type:"message",classification:"Message",attributesAutoComplete:!0}]},type36_Colleciton:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"}]},type38:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.quality,type:"range",property:"Oversampling",min:"75",max:"150"},{name:""+Lang.projectTree.scale,type:"number",property:"ScaleFactor"},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.replaceTerrain,type:"list",property:"ReplaceTerrainWithMesh",list:[{name:""+Lang.projectTree.none,value:0},{name:""+Lang.projectTree.meshGroundLayer,value:1},{name:""+Lang.projectTree.simplifiedMesh,value:2}]},{name:""+Lang.projectTree.displayStyle,type:"list",property:"DisplayStyle",list:[{name:""+Lang.projectTree.texture,value:0},{name:""+Lang.projectTree.xRay,value:2},{name:""+Lang.projectTree.solidColor,value:3}]}],buttons:[{name:""+Lang.projectTree.move,icon:"MoveXY.svg",callback:ID=>{projectTree.editGeometry(ID)},buttonType:0}]},type41:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.altitudeAGL,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.FOV,type:"range",property:"FieldOfViewX",min:"5",max:"125",editCallback:analysis.viewshedFOVChange},{name:""+Lang.projectTree.distance,type:"number",property:"Distance",factor:"feet",min:0,max:1e3},{name:""+Lang.projectTree.direction,type:"number",property:"Position.Yaw",factor:"feet"},{name:""+Lang.projectTree.visibilityDistance,type:"range",property:"Visibility.MaxVisibilityDistance",min:"200",max:"5000"}],helpText:{text:Lang.analysis.viewshedPreviewMode,blink:!0,TEPlusOnly:!0},buttons:[{name:""+Lang.projectTree.calculate,icon:"viewshedQuery.svg",callback:ID=>{analysis.startViewshedQuery(ID)},buttonType:0,TEPlusOnly:!0}]},type1:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.lineWidth,type:"range",property:"LineStyle.Width",min:"0",max:"5",factor:-1},{name:""+Lang.projectTree.lineColor,type:"color",property:"LineStyle.Color"},{name:""+Lang.projectTree.altitudeMethod,type:"list",property:"Position.AltitudeType",list:[{name:""+Lang.projectTree.relative,value:0},{name:""+Lang.projectTree.absolute,value:3},{name:""+Lang.projectTree.onTerrain,value:2}]},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.visibilityDistance,type:"range",property:"Visibility.MaxVisibilityDistance",min:"10",max:"2000",factor:"POW2"},{name:""+Lang.projectTree.tooltip,type:"text",property:"Tooltip.Text"},{name:""+Lang.projectTree.message,type:"message",property:"Message.MessageID"}],buttons:[{name:""+Lang.projectTree.editGeometry,icon:"editGeometry.svg",callback:ID=>{projectTree.editGeometry(ID)},buttonType:1}]},type2:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.lineWidth,type:"range",property:"LineStyle.Width",min:"0",max:"5",factor:-1},{name:""+Lang.projectTree.lineColor,type:"color",property:"LineStyle.Color"},{name:""+Lang.projectTree.fillColor,type:"color",property:"FillStyle.Color"},{name:""+Lang.projectTree.fillOpacity,type:"range",objectSetFunction:"FillStyle.Color.SetAlpha",objectGetFunction:"FillStyle.Color.GetAlpha",min:"0",max:"100",factor:100},{name:""+Lang.projectTree.colorizeModel,type:"list",property:"VolumeClassification.Mode",list:[{name:""+Lang.projectTree.no,value:0},{name:""+Lang.projectTree.yes,value:2}]},{name:""+Lang.projectTree.altitudeMethod,type:"list",property:"Position.AltitudeType",editCallback:projectTree.setPolyAltitudeType,list:[{name:""+Lang.projectTree.relative,value:0},{name:""+Lang.projectTree.absolute,value:3},{name:""+Lang.projectTree.onTerrain,value:2}]},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.visibilityDistance,type:"range",property:"Visibility.MaxVisibilityDistance",min:"10",max:"2000",factor:"POW2"},{name:""+Lang.projectTree.tooltip,type:"text",property:"Tooltip.Text"},{name:""+Lang.projectTree.message,type:"message",property:"Message.MessageID"}],buttons:[{name:""+Lang.projectTree.editGeometry,icon:"editGeometry.svg",callback:ID=>{projectTree.editGeometry(ID)},buttonType:1}]},type18:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.text,type:"text",property:"Text",editCallback:addContent.editTextLabel},{name:""+Lang.projectTree.fontSize,type:"range",property:"Style.FontSize",min:"8",max:"78"},{name:""+Lang.projectTree.textColor,type:"color",property:"Style.TextColor"},{name:""+Lang.projectTree.visibilityDistance,type:"range",property:"Style.Scale",min:"0.1",max:"200"},{name:""+Lang.projectTree.altitudeMethod,type:"list",property:"Position.AltitudeType",list:[{name:""+Lang.projectTree.relative,value:0},{name:""+Lang.projectTree.absolute,value:3}]},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.tooltip,type:"text",property:"Tooltip.Text"},{name:""+Lang.projectTree.message,type:"message",property:"Message.MessageID"}],buttons:[{name:""+Lang.projectTree.editGeometry,icon:"editGeometry.svg",callback:ID=>{projectTree.editGeometry(ID)},buttonType:1}]},type24:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.imageFileName,type:"text",property:"ImageFileName"},{name:""+Lang.projectTree.iconSize,type:"range",property:"Style.MaxImageSize",min:"12",max:"128"},{name:""+Lang.projectTree.iconColor,type:"color",property:"Style.IconColor"},{name:""+Lang.projectTree.visibilityDistance,type:"range",property:"Style.Scale",min:"0.1",max:"200"},{name:""+Lang.projectTree.altitudeMethod,type:"list",property:"Position.AltitudeType",list:[{name:""+Lang.projectTree.relative,value:0},{name:""+Lang.projectTree.absolute,value:3}]},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.tooltip,type:"text",property:"Tooltip.Text"},{name:""+Lang.projectTree.message,type:"message",property:"Message.MessageID"}],buttons:[{name:""+Lang.projectTree.editGeometry,icon:"editGeometry.svg",callback:ID=>{projectTree.editGeometry(ID)},buttonType:1}]},type99:{properties:[{name:""+Lang.projectTree.description,type:"text",property:"TreeItem.Name"},{name:""+Lang.projectTree.altitude,type:"number",property:"Position.Altitude",factor:"feet"},{name:""+Lang.projectTree.tooltip,type:"text",property:"Tooltip.Text"},{name:""+Lang.projectTree.message,type:"message",property:"Message.MessageID"}]},genericButtons:[{name:""+Lang.projectTree.zoom,icon:"zoomTo.svg",callback:ID=>{SGWorld.Navigate.FlyTo(ID)},buttonType:0},{name:""+Lang.projectTree.delete,icon:"Delete.svg",callback:ID=>{projectTree.deleteObject(ID,!0)},buttonType:0},{name:""+Lang.projectTree.close,icon:"OK.svg",callback:ID=>{panel.back()},buttonType:0}]},last:null}}catch(err){application.errorHandling(err.message,0)}},init:function(divName,myDataDivName){try{for(projectTree.initState(),this.render(),this.state.treeDivName="projectTreeDiv",this.state.myDataDivName="myDataTreeDiv",this.loadMyData(),this.state.treeState=2,application.state.TEPLUS&&$("#publishProjectBtn").show(),projectTree.state.defaultValues["LineStyle.Color"]=SGWorld.Creator.CreateColor(services.hexToRgb("#ffffff").r,services.hexToRgb("#ffffff").g,services.hexToRgb("#ffffff").b,255),projectTree.state.defaultValues["FillStyle.Color"]=SGWorld.Creator.CreateColor(services.hexToRgb("#888888").r,services.hexToRgb("#888888").g,services.hexToRgb("#888888").b,255),projectTree.state.defaultValues["Style.TextColor"]=SGWorld.Creator.CreateColor(services.hexToRgb("#ffffff").r,services.hexToRgb("#ffffff").g,services.hexToRgb("#ffffff").b,255),projectTree.state.defaultValues["Style.IconColor"]=SGWorld.Creator.CreateColor(services.hexToRgb("#ff0000").r,services.hexToRgb("#000000").g,services.hexToRgb("#000000").b,255),projectTree.state.defaultValues.ImageFileName=services.abspath()+"/images/icons/iconWhite.png",SGWorld.AttachEvent("OnInputModeChanged",projectTree.OnInputModeChanged),i=0;i<=2;i++)"0.1rem"==$("#layersButtonState"+i).css("background-size").toLowerCase()&&(this.state.treeState=i)}catch(err){application.errorHandling(err.message,0)}},render:function(){try{$("body").append(` 
        <div id="layersMain" class="grid1 gridPadding"  style="display:none">
            <div id="myData">
                <div id="myDataTitle" class="propertiesTitle ">${Lang.projectTree.myData}
                    <button class="ButtonSmall spacerLeft" id="deleteBtn" onclick="projectTree.DeleteMyData()"  title="${Lang.projectTree.deleteAll}"><img src="images/treeIcons/deleteAll.svg" ></button>    
                    <button class="ButtonSmall" id="publishProjectBtn" class=" " onclick="addContent.openPublishMyData();"  title="${Lang.addContent.publishProject}"  style="display:none"><img src="images/icons/share.svg" ></button>    
                </div>
                <div id="myDataTreeDiv" class="projectTree "></div>
                <div  class="seperator"></div>
            </div>

            <div class="propertiesTitle">
                <span id="projectTreeTitle" >${Lang.projectTree.project}</span>
                <button class="ButtonSmall spacerLeft" id="layersButtonState2" onclick="projectTree.setTreeState(2,false)" title="${Lang.projectTree.projectTree}"><img src="images/treeIcons/projectTree.svg" > </button>
                <button class="ButtonSmall" id="layersButtonState0" onclick="projectTree.setTreeState(0,false)" title="${Lang.projectTree.navigationLayers}"><img src="images/treeIcons/projectNavigate.svg" >  </button>
                <button class="ButtonSmall" id="layersButtonState1" onclick="projectTree.setTreeState(1,false)" title="${Lang.projectTree.dataLayers}"> <img src="images/treeIcons/projectLayers.svg" >  </button>
            </div>
            <div id="projectTreeDiv" class=" projectTree"></div>
        </div>`),$("body").append(` 
        <div id="propertiesSheetDiv" class="grid2 gridPadding gridRowGapLarge spacerAbove" style="display:none"> </div>`)}catch(err){application.errorHandling(err.message,0)}},onShow:function(){try{this.setTreeState(this.state.treeState,!0)}catch(err){application.errorHandling(err.message,0)}},resize:function(height){},setTreeState:function(state,buildMyData){try{for(i=0;i<=2;i++)$("#layersButtonState"+i).removeClass("ButtonChecked");$("#projectTreeDiv").css("opacity","0"),$("#layersButtonState"+state).addClass("ButtonChecked"),$("#"+this.state.treeDivName).html(""),this.state.treeState=state,buildMyData&&""!=this.state.myDataGroupID&&(this.state.findMyData=!1,$("#"+this.state.myDataDivName).html(""),this.BuildProjectTree(this.state.myDataGroupID,this.state.myDataDivName,!0)),this.BuildProjectTree(SGWorld.ProjectTree.RootID,this.state.treeDivName,!1),this.refreshShowHideState(SGWorld.ProjectTree.RootID),projectTree.showHideDivs(),setTimeout(function(){$("#projectTreeDiv").css("opacity","1")},200)}catch(err){application.errorHandling(err.message,0)}},BuildProjectTree:function(parentNode,parentDiv,myData){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){if(node!=this.state.myDataGroupID){var isGroup=SGWorld.ProjectTree.IsGroup(node),isKML=!1,isFeatureLayer=SGWorld.ProjectTree.IsLayer(node),addItem=!(!myData&&2!=this.state.treeState),itemName=SGWorld.ProjectTree.GetItemName(node),checked=0==SGWorld.ProjectTree.GetVisibility(node)?"":"checked",featureGeometryTye="",objectType=-1,groupExpanded=!1;try{var object=SGWorld.Creator.GetObject(node);36==(objectType=object.ObjectType)&&(featureGeometryTye="_"+object.GeometryType),0<=this.state.treeItemsLayers.indexOf(objectType)&&(isGroup=!1),0<=this.state.treeItemsKML.indexOf(objectType)&&(isKML=!0),(myData||1==this.state.treeState&&(0<=this.state.treeItemsLayers.indexOf(objectType)||isKML)||0==this.state.treeState&&0<=this.state.treeItemsNavigate.indexOf(objectType))&&(addItem=!0)}catch(err){}try{object.TreeItem.ShowInViewerTree||(addItem=!1)}catch(err){}var regularGroup,iconName,htmlStr="";addItem&&(myData&&(this.state.findMyData=!0),isGroup&&SGWorld.ProjectTree.IsExpanded(node)&&(groupExpanded=!0),htmlStr+=`<div id="treeItem_${node}" class='treeItemLine link' onclick='projectTree.treeActivateItem("${node}",${regularGroup=isGroup&&!isFeatureLayer&&0==SGWorld.ProjectTree.IsLocked(node)})' >`,regularGroup&&(myData||2==this.state.treeState)?htmlStr+=`<img src='./images/treeIcons/${groupExpanded?"minus":"plus"}.svg' onclick='projectTree.expandCollapseGroup("${node}");event.stopPropagation();' class='link treeFolderPlusMinus'>`:htmlStr+="<div class='treeSpacerSmall'></div>",-1==this.state.treeItemsWithoutCheckbox.indexOf(objectType)?htmlStr+=`<input id="treeItemCheck_${node}" class='treeCheck' type='${""!=parentNode&&SGWorld.ProjectTree.IsRadioGroup(parentNode)?"radio":"checkbox"}' onclick='projectTree.showHide ("${node}");event.stopPropagation();' ${checked}>`:htmlStr+="<div class='treeSpacerLarge'></div>",iconName=this.state.treeItemIcons.object,!isGroup||isFeatureLayer||isKML?void 0!==this.state.treeItemIcons["_"+objectType]&&(iconName=this.state.treeItemIcons["_"+objectType+featureGeometryTye]):iconName=this.state.treeItemIcons.folder,htmlStr=(htmlStr+=`<img class='treeIcon' absmiddle src='./images/treeIcons/${iconName}' width='${projectTree.state.treeIconSize}' height='${projectTree.state.treeIconSize}'>`)+`<span class='treeItemName'>${itemName}</span><br>`+"</div>",$("#"+parentDiv).append(htmlStr),$("#treeItem_"+node).on("contextmenu",function(e){e.preventDefault();var menu=projectTree.buildContextMenu(e.currentTarget,myData);superCm.createMenu(menu,e)})),isGroup&&(addItem?(htmlStr=`<div id='treeItemDiv_${node}' class='treeFolderDiv' style='${groupExpanded?"":"display:none"}'></div>`,$("#"+parentDiv).append(htmlStr),this.BuildProjectTree(node,"treeItemDiv_"+node,myData)):this.BuildProjectTree(node,parentDiv,myData))}node=SGWorld.ProjectTree.GetNextItem(node,13)}}catch(err){application.errorHandling(err.message,0)}},buildContextMenu:function(targetObject,myData){try{var objectID=targetObject.id.split("treeItem_")[1],objectType=0,objectName=SGWorld.ProjectTree.GetItemName(objectID),menu=[];try{objectType=SGWorld.Creator.GetObject(objectID).ObjectType}catch(e){}return 34==objectType?menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.playPresentation,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),navigate.PlayObject(objectID,!0)}}):(menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.flyToObject,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),SGWorld.Navigate.FlyTo(objectID)}}),menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.jumpToObject,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),SGWorld.Navigate.FlyTo(objectID,14)}})),19==objectType&&menu.push({objectID:objectID,objectType:objectType,label:""+Lang.navigate.shareLocation,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),navigate.shareLocation(objectID)}}),38==objectType&&menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.clipModel,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.openTool(objectID,""+Lang.projectTree.clip+objectName,1,projectTree.state.toolsURL.ClipModel+"?ID="+objectID+"&lang="+Lang.code)}}),36==objectType&&(menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.queryLayer,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),features.show(objectID,0)}}),application.state.TEPLUS)&&features.state.allowFeatureEditing&&menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.editLayer,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),features.show(objectID,1)}}),myData&&(menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.properties,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.openPropertiesSheet(objectID,Lang.projectTree.properties+":"+objectName,"projectTree.state.style")}}),menu.push({objectID:objectID,objectType:objectType,label:""+Lang.projectTree.delete,submenu:null,disabled:!1,action:function(option,contextMenuIndex,optionIndex){superCm.destroyMenu(),projectTree.deleteObject(objectID,!1)}})),menu}catch(err){return application.errorHandling(err.message,0),null}},expandCollapseGroup:function(div){try{var divElement=$("#treeItemDiv_"+div);divElement.is(":visible")?(divElement.hide(),SGWorld.ProjectTree.ExpandGroup(div,!1),$("#treeItem_"+div).find("img:eq(0)").attr("src","./images/treeIcons/plus.svg")):(divElement.show(),SGWorld.ProjectTree.ExpandGroup(div,!0),$("#treeItem_"+div).find("img:eq(0)").attr("src","./images/treeIcons/minus.svg"))}catch(err){application.errorHandling(err.message,0)}},treeActivateItem:function(itemID,isGroup){try{isGroup?projectTree.expandCollapseGroup(""+itemID):navigate.PlayObject(itemID,!1)}catch(err){application.errorHandling(err.message,0)}},showHide:function(id){try{var show=0!=SGWorld.ProjectTree.GetVisibility(id);SGWorld.ProjectTree.SetVisibility(id,!show),this.refreshShowHideState(SGWorld.ProjectTree.RootID)}catch(err){application.errorHandling(err.message,0)}},refreshShowHideState:function(parentNode){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){var visibilityState=SGWorld.ProjectTree.GetVisibility(node),checked=0!=visibilityState;$("#treeItemCheck_"+node).prop("checked",checked),2==visibilityState?$("#treeItemCheck_"+node).addClass("treeCheckIndeterminate"):$("#treeItemCheck_"+node).removeClass("treeCheckIndeterminate"),SGWorld.ProjectTree.IsGroup(node)&&this.refreshShowHideState(node),node=SGWorld.ProjectTree.GetNextItem(node,13)}}catch(err){application.errorHandling(err.message,0)}},loadMyData:function(){try{projectTree.state.inLoadMyData=!0,SGWorld.ProjectTree.LoadFlyLayerAsync(SGWorld.Application.DataPath+"/"+projectTree.getMyDataFileName()+".fly").OnResolve(function(layerID){projectTree.state.myDataGroupID=SGWorld.ProjectTree.GetNextItem(layerID,11),""!=projectTree.state.myDataGroupID&&(SGWorld.ProjectTree.SetParent(projectTree.state.myDataGroupID,SGWorld.ProjectTree.RootID),SGWorld.ProjectTree.RenameGroup(projectTree.state.myDataGroupID,projectTree.state.myDataGroupName),SGWorld.SetParam(9952,projectTree.state.myDataGroupID)),SGWorld.ProjectTree.DeleteItem(layerID),projectTree.state.inLoadMyData=!1}).OnReject(function(error){projectTree.state.myDataGroupID=SGWorld.ProjectTree.CreateGroup(projectTree.state.myDataGroupName,SGWorld.ProjectTree.RootID),SGWorld.SetParam(9952,projectTree.state.myDataGroupID),projectTree.state.inLoadMyData=!1})}catch(err){}},getMyDataGroup:function(){try{return this.state.myDataGroupID}catch(err){return application.errorHandling(err.message,0),""}},getDrawingObjectsGroup:function(){try{if(null!=projectTree.state.myDrawingObjectsGroup)try{SGWorld.ProjectTree.GetItemName(projectTree.state.myDrawingObjectsGroup)}catch(e){projectTree.state.myDrawingObjectsGroup=SGWorld.ProjectTree.CreateGroup(Lang.projectTree.drawingObjects,projectTree.state.myDataGroupID)}else projectTree.state.myDrawingObjectsGroup=SGWorld.ProjectTree.FindItem(projectTree.state.myDataGroupName+"\\"+Lang.projectTree.drawingObjects),""!=projectTree.state.myDrawingObjectsGroup&&null!=projectTree.state.myDrawingObjectsGroup||(projectTree.state.myDrawingObjectsGroup=SGWorld.ProjectTree.CreateGroup(Lang.projectTree.drawingObjects,projectTree.state.myDataGroupID));return projectTree.state.myDrawingObjectsGroup}catch(err){return application.errorHandling(err.message,0),""}},refreshMyData:function(){try{""!=this.state.myDataGroupID&&($("#"+this.state.myDataDivName).html(""),this.state.findMyData=!1,this.BuildProjectTree(this.state.myDataGroupID,this.state.myDataDivName,!0),this.refreshShowHideState(SGWorld.ProjectTree.RootID),projectTree.showHideDivs(),application.state.disabledMessageBar=!0,SGWorld.ProjectTree.SaveAsFlyAsync(projectTree.getMyDataFileName(),this.state.myDataGroupID).OnResolve(function(flyName){application.state.disabledMessageBar=!1}).OnReject(function(error){application.state.disabledMessageBar=!1,application.errorHandling(error,0)}))}catch(err){application.errorHandling(err.message,0)}},showHideDivs:function(){try{this.state.findMyData?$("#myData").show():$("#myData").hide()}catch(err){application.errorHandling(err.message,0)}},getMyDataFileName:function(){try{return services.cleanURL(application.state.projectPath)}catch(err){return application.errorHandling(err.message,0),""}},editGeometry:function(objectID){try{SGWorld.Creator.GetObject(objectID);null==projectTree.state.editGeometryBtn&&(projectTree.state.editGeometryBtn=$(event.target),projectTree.state.editGeometryBtn.is(":button")||(projectTree.state.editGeometryBtn=projectTree.state.editGeometryBtn.parent())),projectTree.state.inEditGeometry?(projectTree.state.inEditGeometry=!1,SGWorld.Window.SetInputMode(0),projectTree.state.editGeometryBtn.removeClass("ButtonChecked")):(projectTree.state.inEditGeometry=!0,SGWorld.ProjectTree.EditItemEx(objectID,16386,0,0,0),projectTree.state.editGeometryBtn.addClass("ButtonChecked"))}catch(err){return application.errorHandling(err.message,0),""}},OnInputModeChanged:function(mode){try{0==mode&&projectTree.state.inEditGeometry&&(projectTree.state.editGeometryBtn.removeClass("ButtonChecked"),projectTree.state.inEditGeometry=!1)}catch(err){application.errorHandling(err.message,0)}},deleteObject:function(objectID,fromPS){try{confirm(Lang.projectTree.deleteConfirm)&&(SGWorld.ProjectTree.DeleteItem(objectID),fromPS&&panel.back(),projectTree.refreshMyData())}catch(err){return application.errorHandling(err.message,0),""}},DeleteMyData:function(){try{if(confirm(""+Lang.projectTree.sure)){for(var node=SGWorld.ProjectTree.GetNextItem(projectTree.state.myDataGroupID,11);""!=node;){var object=SGWorld.Creator.GetObject(node);try{object.ObjectType}catch(e){}var nextNode=SGWorld.ProjectTree.GetNextItem(node,13);SGWorld.ProjectTree.DeleteItem(node),node=nextNode}projectTree.refreshMyData()}}catch(err){return application.errorHandling(err.message,0),""}},openTool:function(itemID,toolName,type,url){url=url+"?lang="+Lang.code+"&root="+projectTree.getMyDataGroup();panel.addAndShow(1,url,toolName,projectTree.closeTool,panel.state.widthSmall,panel.state.heightMedium,!1,0)},closeTool:function(){try{features.closeTool(),projectTree.refreshMyData(),SGWorld.Application.Selection.RemoveAll(),projectTree.state.inEditGeometry=!1,SGWorld.Window.SetInputMode(0)}catch(err){application.errorHandling(err.message,0)}},openPropertiesSheet:function(itemID,title,propertiesList){try{projectTree.state.PSDiv=$("#propertiesSheetDiv").clone(),projectTree.state.PSIndex++,projectTree.state.PSDiv.prop("id","PSDiv"+projectTree.state.PSIndex),$("body").append(projectTree.state.PSDiv);try{null!=itemID&&null==SGWorld.Creator.GetObject(itemID)?projectTree.buildGroupPropertiesSheet(itemID,propertiesList,projectTree.state.PSDiv):projectTree.buildPropertiesSheet(itemID,propertiesList,projectTree.state.PSDiv)}catch(e){}projectTree.state.inEditGeometry=!1,projectTree.state.editGeometryBtn=null,panel.addAndShow(0,projectTree.state.PSDiv.attr("id"),title,projectTree.closeTool,panel.state.widthSmall,panel.state.heightLarge,!1,0)}catch(err){application.errorHandling(err.message,0)}},buildPropertiesSheet:function(itemID,propertiesList,PSDiv){try{var initVal="",origObjectType=objectType=0,object=null,suggestionsContainer;try{object=SGWorld.Creator.GetObject(itemID),origObjectType=objectType=object.ObjectType}catch(e){origObjectType=objectType=99}36==objectType&&(objectType+="_"+this.state.geometryTypes[object.GeometryType],suggestionsContainer=$('<div  class="suggestions-container boxShadowSmall"></div>'),PSDiv.append(suggestionsContainer),projectTree.state.attributesList=[]);var PSArray=eval(propertiesList+'["type"+objectType]'),helpTextSpan,buttonsArea=(null==PSArray&&(PSArray=eval(propertiesList+'["type99"]')),$.each(PSArray.properties,function(index,value){var type=value.type,inputField,findAttribute=!0,regex,type,color;try{36==origObjectType&&null!=value.classification?(object.FeatureGroups[projectTree.state.geometryTypes[object.GeometryType]].IsClassified(value.classification)?(initVal=object.FeatureGroups[projectTree.state.geometryTypes[object.GeometryType]].GetClassification(value.classification),initVal=initVal.replaceAll("'",'"'),0<=initVal.indexOf("<Classification")&&(type="text",0<=initVal.indexOf('FuncType="0"'))&&(regex=/<Value>(.*?)<\/Value>/,initVal=regex.exec(initVal)[1])):initVal=eval("object.FeatureGroups[projectTree.state.geometryTypes[object.GeometryType]].GetProperty(value.classification)"),"color"==type&&(color=SGWorld.Creator.CreateColor(),color.FromABGRColor(initVal),initVal=color.ToHTMLColor())):null!=value.property?(initVal=eval("object."+value.property),"color"==type&&(initVal=initVal.ToHTMLColor())):null!=value.variable?initVal=eval(value.variable):null!=value.objectGetFunction&&(initVal=eval(`object.${value.objectGetFunction}()`))}catch(e){findAttribute=!1}if(findAttribute){PSDiv.append($(`<div class='gridLeft'>${value.name}</div>`));var inputDiv=$("<div class='gridRight' ></div"),factor=(PSDiv.append(inputDiv),null),suggestionsBtn;switch(type){case"number":case"range":factor=null!=value.factor?value.factor:1,"feet"==value.factor&&(factor=settings.state.unitRatio),"string"==typeof value.factor&&0<=value.factor.indexOf("POW2")&&(factor=1);var minMaxFactor="range"==type?1:Math.abs(factor),minStr=null!=value.min?`min='${value.min*minMaxFactor}'`:"",maxStr=null!=value.max?`max='${value.max*minMaxFactor}'`:"",step=(initVal=("string"==typeof value.factor&&0<=value.factor.indexOf("POW2")?+Math.sqrt(initVal):+initVal*factor).toFixed(5),"range"==type?"0.1":"1");case"text":case"color":inputField=$(`<input type='${type}' value='${initVal}' ${minStr} ${maxStr} step='${step}' class='ID_${value.identified}' >`);break;case"list":var select=`<select class='ID_${value.identified}'>`;$.each(value.list,function(index,listValue){var selected=listValue.value==initVal?'selected="selected"':"";select+=`<option value=${listValue.value} ${selected}>${listValue.name}</option>> `}),select+="</select>",inputField=$(select);break;case"message":try{initVal=SGWorld.Creator.GetObject(initVal).InnerText+SGWorld.Creator.GetObject(initVal).InnerHTML+SGWorld.Creator.GetObject(initVal).Src}catch(e){initVal=""}inputField=$(`<input type='text' value='${initVal}' class='ID_${value.identified}' >`)}inputDiv.append(inputField),inputField.on("change",function(){projectTree.updateProperty(inputField,itemID,value,factor)}),null!=value.attributesAutoComplete&&1==value.attributesAutoComplete&&(suggestionsBtn=$(`<img class=' suggestionImg link' src="images/icons/attrSuggestions.svg">`),inputDiv.append(suggestionsBtn),suggestionsBtn.on("click",function(event){projectTree.showAttributeSuggestions(itemID,inputField,suggestionsContainer,event.target)}))}}),null!=PSArray.helpText&&(null==PSArray.helpText.TEPlusOnly||0==PSArray.helpText.TEPlusOnly||1==PSArray.helpText.TEPlusOnly&&application.state.TEPLUS)&&(helpTextSpan=$(`<div class='ID_${PSArray.helpText.identified} gridDouble highlightBackground '>${PSArray.helpText.text}</div>`),PSArray.helpText.blink&&helpTextSpan.addClass("blinking-text"),PSDiv.append(helpTextSpan)),$("<div class='gridDouble'></div>")),buttonsList=(PSDiv.append(buttonsArea),$.each(PSArray.buttons,function(index,button){var title;(null==button.TEPlusOnly||0==button.TEPlusOnly||1==button.TEPlusOnly&&application.state.TEPLUS)&&(title=void 0!==button.title?`title='${button.title}'`:"",buttonsArea.append($(`<button class=' ButtonLarge  ' onclick='${propertiesList}.type${objectType}.buttons[${index}].callback("${itemID}")' ${title}><img src="images/icons/${button.icon}"><br><span>${button.name}</span></button>))`)))}),eval(propertiesList+'["genericButtons"]'));$.each(buttonsList,function(index,button){(0==button.buttonType||-1<projectTree.state.editGeometryTypes.indexOf(origObjectType))&&buttonsArea.append($(`<button class=' ButtonLarge  ' onclick='${propertiesList}.genericButtons[${index}].callback("${itemID}")'><img src="images/icons/${button.icon}"><br><span>${button.name}</span></button>))`))})}catch(err){return application.errorHandling(err.message,0),""}},updateProperty:function(inputField,itemID,element,factor){try{var newValue=inputField.val(),object=null,messageType,newValue,command;null!=itemID&&(object=SGWorld.Creator.GetObject(itemID)),"range"!=element.type&&"number"!=element.type||(null===factor&&(factor=1),newValue="string"==typeof element.factor&&0<=element.factor.indexOf("POW")?Math.pow(inputField.val(),2):inputField.val()/factor),"message"==element.type&&(messageType=0==newValue.indexOf("http")?1:0,newValue=SGWorld.Creator.CreateMessage(5,newValue,messageType,!0).ID),null!=object&&36==object.ObjectType&&null!=element.classification?(command="SetProperty",0<=(newValue+"").indexOf("<Classification")&&(command="SetClassification"),eval(`object.FeatureGroups.${projectTree.state.geometryTypes[object.GeometryType]}.${command}('${element.classification}','${newValue}')`)):null!=object&&null!=element.property?("color"==element.type?(newValue=SGWorld.Creator.CreateColor(services.hexToRgb(newValue).r,services.hexToRgb(newValue).g,services.hexToRgb(newValue).b,255*eval(`object.${element.property}.GetAlpha()`)),eval(`object.${element.property} = newValue`)):eval(`object.${element.property} = "${newValue}"`),void 0!==projectTree.state.defaultValues[element.property]&&(projectTree.state.defaultValues[element.property]=newValue)):null!=object&&null!=element.objectSetFunction?eval(`object.${element.objectSetFunction} (${newValue})`):null!=element.variable&&eval(element.variable+` = "${newValue}"`),null!=element.editCallback&&element.editCallback(itemID)}catch(err){return""}},showAttributeSuggestions:function(itemID,inputField,suggestionsContainer,target){try{projectTree.state.attributesList=[];var featureLayer=SGWorld.Creator.GetObject(itemID);application.state.suppressMessages=!0,featureLayer.ExecuteQueryAsync("",1,"",SGWorld.Creator.GeometryCreator.CreatePolygonGeometry(null)).OnResolve(function(features){application.state.suppressMessages=!1;for(var i=0;i<features.Item(0).FeatureAttributes.Count;i++)projectTree.state.attributesList.push(`[${features.Item(0).FeatureAttributes.Item(i).Name}]`);suggestionsContainer.empty(),projectTree.displaySuggestions(projectTree.state.attributesList,inputField,suggestionsContainer),suggestionsContainer.css({left:target.offsetLeft+target.width/2+"px",top:target.offsetTop+target.height/2+"px"})}).OnReject(function(error){application.state.suppressMessages=!1})}catch(err){return application.errorHandling(err.message,0),""}},displaySuggestions:function(filteredSuggestions,inputField,suggestionsContainer){try{suggestionsContainer.empty();var closeDiv=$("<div>").addClass("suggestion"),close=(suggestionsContainer.append(closeDiv),$("<img>").addClass("link").attr("src","./images/icons/close.svg"));closeDiv.on("click",function(){suggestionsContainer.empty()}),closeDiv.append(close),filteredSuggestions.forEach(suggestion=>{var line=$("<div>").addClass("suggestion").text(suggestion);line.on("click",function(){inputField.val(suggestion),inputField.trigger("change"),suggestionsContainer.empty()}),suggestionsContainer.append(line)})}catch(err){return application.errorHandling(err.message,0),""}},setPolyAltitudeType:function(itemID){try{SGWorld.Creator.GetObject(itemID)}catch(err){return application.errorHandling(err.message,0),""}},buildGroupPropertiesSheet:function(itemID,propertiesList,PSDiv){try{var initVal="",PSArray=eval(propertiesList+'["typeGroup"]'),buttonsArea=($.each(PSArray.properties,function(index,value){var inputField;"description"===value.type&&(PSDiv.append($(`<div class='gridLeft'>${value.name}</div>`)),value=$("<div class='gridRight' ></div"),PSDiv.append(value),initVal=SGWorld.ProjectTree.GetItemName(itemID),inputField=$(`<input type='text' value='${initVal}' >`),value.append(inputField),inputField.on("change",function(){SGWorld.ProjectTree.RenameGroup(itemID,inputField.val())}))}),$("<div class='gridDouble'></div>")),buttonsList=(PSDiv.append(buttonsArea),$.each(PSArray.buttons,function(index,button){buttonsArea.append($(`<button class=' ButtonLarge  ' onclick='${propertiesList}.type${objectType}.buttons[${index}].callback("${itemID}")'><img src="images/icons/${button.icon}"><br><span>${button.name}</span></button>))`))}),eval(propertiesList+'["genericButtons"]'));$.each(buttonsList,function(index,button){(0==button.buttonType||-1<projectTree.state.editGeometryTypes.indexOf(origObjectType))&&buttonsArea.append($(`<button class=' ButtonLarge  ' onclick='${propertiesList}.genericButtons[${index}].callback("${itemID}")'><img src="images/icons/${button.icon}"><br><span>${button.name}</span></button>))`))})}catch(err){return application.errorHandling(err.message,0),""}},dummy:null};