this.JSON||(this.JSON={}),!function(){function f(n){return n<10?"0"+n:n}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),typeof(value="function"==typeof rep?rep.call(holder,key,value):value)){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]"}else{if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof(k=rep[i])&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);else for(k in value)Object.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}"}return gap=mind,v}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;if(indent=gap="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(!(rep=replacer)||"function"==typeof replacer||"object"==typeof replacer&&"number"==typeof replacer.length)return str("",{"":value});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.hasOwnProperty.call(value,k)&&(void 0!==(v=walk(value,k))?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var TEF=!1;function initSGWorld(clsid){if(null==clsid&&(clsid="3a4f91a1-65a8-11d5-85c1-0001023952c1"),null!=SGWorld)return SGWorld;if(parent&&parent.SGWorld)return SGWorld=parent.SGWorld,TEF=!0,SGWorld;try{var obj=document.createElement("object");return obj.setAttribute("id","__sgworld_ie__"),obj.setAttribute("classid","CLSID:3a4f91a1-65a8-11d5-85c1-0001023952c1"),document.body.appendChild(obj),SGWorld=__sgworld_ie__.CreateInstance(clsid)}catch(e){}try{return SGWorld=__sgworld__.CreateInstance(clsid)}catch(e){}return null}function DisplayMessagePopup(title,header,icon,body,x,y,width,height,CloseButton){var HTMLString;TEF?parent.application.openPopupDialog(0,body,header,width,height,-1):(HTMLString='<html><head><meta http-equiv="X-UA-Compatible" content="IE=9"/><link rel=\'StyleSheet\' href=\''+abspath()+"/../Style.css' type='text/css'></head><body leftmargin='0' topmargin='0' marginwidth='0' marginheight='0'><object id='SGWorld' classid='CLSID:3a4f9197-65a8-11d5-85c1-0001023952c1' style='display:none'></object>",HTMLString+="<table width='100%' height='100%' cellpadding=4pt cellspacing=0 border=0> <tr height='20pt'>",""!=icon&&(HTMLString+="<td align='left' width='50pt'><img src='"+icon+"' alt='' ></td>"),""!=header&&(HTMLString+="<td align='middle'><span class='s12b'>"+header+"</span></td>"),HTMLString+="<td width='50pt'></td></tr><tr><td valign='top' colspan=3><span class='s9'>"+body+"</span></td></tr>",CloseButton&&(HTMLString+="<tr><td align='right' valign=bottom colspan=3 style='background-color:#eeeeee'><input type='button' class='MenuButtonSmall' value='Close' onClick='SGWorld.Window.RemovePopupByCaption(\""+title+"\");' /></td></tr>"),HTMLString+="</body></html>",(icon=SGWorld.Creator.CreatePopupMessage(title,"",x,y,width,height,-1)).Flags=32802,icon.InnerText=HTMLString,SGWorld.Window.ShowPopup(icon))}function TEAlert(caption,text,info){parent&&parent.SGWorld?alert(text):DisplayMessagePopup(caption,"",1==info?abspath()+"/../commonimg/info.png":abspath()+"/../commonimg/alert.png",text,SGWorld.Window.Rect.Width/2-200,SGWorld.Window.Rect.Height/2-75,400,150,!0)}function DisplayHelpPopup6(HTMLSrc,title){null!=title&&""!=title||(title="?");title=SGWorld.Creator.CreatePopupMessage(title,abspath()+"/"+HTMLSrc,5,5,850,500);title.AllowDrag=!0,title.AllowResize=!0,SGWorld.Window.ShowPopup(title)}function CloseTool(ToolName){TE.interface("IContainer2").RemoveURL(1,ToolName)}function abspath(fixUNC){var abspath=unescape(window.location.href),index2=(index=(abspath=0<(index=abspath.indexOf("?"))?abspath.substr(0,index-1):abspath).lastIndexOf("/"),abspath.lastIndexOf("\\")),index=index2<index?index:index2;return index<=0||(index2=/file:\/\/\//gi,null!=(abspath="/"==(abspath=abspath.substring(0,index)).substring(0,1)?abspath.slice(1):abspath).match(index2)&&(abspath=abspath.replace(index2,"")),fixUNC&&(abspath=abspath.replace("file://","file:////"))),abspath}function GetParamValue(findParam,defaultValue){var arr=document.location.href.split("?");if(!(arr.length<=1))for(var arr=arr[1].split("&"),i=0;i<arr.length;i++)if(0==arr[i].indexOf(findParam)&&arr[i].indexOf("=")==findParam.length)return(arr=arr[i].split("="))[1];return defaultValue}function removeURLParameter(findParam){try{findParam=findParam.toLowerCase();var arr=document.location.href.split("#")[0].split("?");if(!(arr.length<=1))for(var url,arr=arr[1].split("&"),i=0;i<arr.length;i++)if(0==arr[i].toLowerCase().indexOf(findParam)&&arr[i].toLowerCase().indexOf("=")==findParam.length)return arr.splice(i,1),url=document.location.href.split("#")[0].split("?")[0]+"?"+arr.join("&"),window.history.replaceState(null,null,url),!0;return!1}catch(err){return console.error(err.message),!1}}function validateNumber(strNum){return strNum=strNum.replace(/,/,"."),parseFloat(strNum)}function validateNumberEx(field,defVal,MinNum,MaxNum){try{field.val(validateNumber(field.val())),field.val()<MinNum&&field.val(MinNum),field.val()>MaxNum&&field.val(MaxNum)}catch(e){field.val(defVal)}}function CheckNumberEx(field,defVal,MinNum,MaxNum){try{isNaN(field.value)&&(field.value=defVal),field.value<MinNum&&(field.value=MinNum),field.value>MaxNum&&(field.value=MaxNum)}catch(e){field.value=defVal}}$(document).ready(function(){$(document.body).hide(),TEF?(SGLang.LoadLangScript(),parent.application.state.isMobile&&$("html").css("font-size","3.5vw")):SGLang.translateDocument()}),SGLang={lang:{},defaultCode:"0",getCode:function(){return SGLang.getUrlParameters().lang||SGLang.defaultCode},getUrlParameters:function(){for(var keyValuePairs=window.location.href.split(/[&?]/g),params={},i=0,n=keyValuePairs.length;i<n;++i){var key,m=keyValuePairs[i].match(/^([^=]+)(?:=([\s\S]*))?/);m&&(params[key=decodeURIComponent(m[1])]||(params[key]=[])).push(decodeURIComponent(m[2]))}return params},i18n:function(key,context){var message=(message=SGLang.lang[key])||key;return message=context?SGLang.format(message,context):message},i18nFile:function(file){var code=this.getCode();return"0"==code||"1033"==code?file:code+"/"+file},format:function(template,context,args){context=context||window;return template.replace(SGLang.tokenRegEx,function(str,match){for(var replacement,subs=match.split(/\.+/),i=0;i<subs.length;i++)replacement=(replacement=0==i?context:replacement)[subs[i]];return void 0===(replacement="function"==typeof replacement?args?replacement.apply(null,args):replacement():replacement)?"undefined":replacement})},translateDocument:function(){document.title=SGLang.i18n(document.title),$(".i18n").each(function(){"INPUT"==this.tagName?this.value=SGLang.i18n(this.value):"IMG"==this.tagName?($(this).attr("src",SGLang.i18n($(this).attr("src"))),$(this).attr("alt",SGLang.i18n($(this).attr("alt"))),$(this).attr("title",SGLang.i18n($(this).attr("title")))):($(this).attr("title",SGLang.i18n($(this).attr("title"))),$(this).attr("alt",SGLang.i18n($(this).attr("alt"))),0==$(this).children().length&&$(this).html(SGLang.i18n($.trim($(this).text()))))}),$(".i18nFile").each(function(){"IMG"==this.tagName&&$(this).attr("src",SGLang.i18nFile($(this).attr("src")))}),$(document.body).show(),"function"==typeof Init&&Init()},LoadLangScript:function(){var toolName,code=SGLang.getCode();0==code?SGLang.LoadEnglishScript():(toolName=TEF?(toolName=abspath().substring(abspath().lastIndexOf("/")+1),"../../lang/"+parent.application.state.langCode+"/"+toolName+".js"):code+"/Lang.js",$.ajax({url:toolName,dataType:"script",success:SGLang.translateDocument,error:SGLang.LoadEnglishScript}))},LoadEnglishScript:function(){var toolName=abspath().substring(abspath().lastIndexOf("/")+1),toolName=TEF?"../../lang/en/"+toolName+".js":"Lang.js";$.ajax({url:toolName,dataType:"script",success:SGLang.translateDocument})},tokenRegEx:/\$\{([\w.]+?)\}/g},!function(){var head,script,script2;parent&&parent.SGWorld?TEF=!0:(head=document.head||document.getElementsByTagName("head")[0],firstScript=head.getElementsByTagName("script")[0],(script=document.createElement("script")).setAttribute("src","Lang.js"),head.insertBefore(script,firstScript),script=SGLang.getCode(),(script2=document.createElement("script")).setAttribute("src",script+"/Lang.js"),head.insertBefore(script2,firstScript))}();var gDrawingEditMode=0,drawing={drawingEditMode:-1,polyObject:null,helpLine:null,drawPolygon:function(options){drawing_startDrawing(2,options)},drawPolyline:function(options){drawing_startDrawing(1,options)},abort:function(deleteObj){drawing_finishDrawing(!0)}};function drawing_startDrawing(type,options){try{drawing.drawingEditMode=type,drawing.options=options,SGWorld.AttachEvent("OnLButtonClicked",drawing_DrawPolyLButtonClicked),SGWorld.AttachEvent("OnRButtonUp",drawing_DrawPolyRButtonUp),SGWorld.AttachEvent("OnFrame",drawing_DrawPolyOnFrame),SGWorld.AttachEvent("OnInputModeChanged",drawing_DrawPolyInputModeChanged),SGWorld.Window.SetInputMode(1,abspath()+"/cursor_m.cur",!0)}catch(err){gDebug&&alert("ToolsCommon -> drawing_startDrawing: "+err.message)}}function drawing_finishDrawing(deleteObject){try{deleteObject&&null!=drawing.polyObject&&SGWorld.Creator.DeleteObject(drawing.polyObject.ID),null!=drawing.helpLine&&SGWorld.Creator.DeleteObject(drawing.helpLine.ID),drawing.polyObject=null,drawing.helpLine=null,drawing.options.onAbort()}catch(err){}try{SGWorld.DetachEvent("OnLButtonClicked",drawing_DrawPolyLButtonClicked),SGWorld.DetachEvent("OnRButtonUp",drawing_DrawPolyRButtonUp),SGWorld.DetachEvent("OnFrame",drawing_DrawPolyOnFrame),SGWorld.DetachEvent("OnInputModeChanged",drawing_DrawPolyInputModeChanged),SGWorld.Window.SetInputMode(0),drawing.drawingEditMode=-1}catch(err){}}function drawing_DrawPolyInputModeChanged(NewMode){1!=NewMode&&-1!=drawing.drawingEditMode&&drawing.abort()}function drawing_DrawPolyLButtonDown(Flags,X,Y){drawing_DrawPolyLButtonClicked(Flags,X,Y)}function drawing_DrawPolyLButtonClicked(Flags,X,Y){try{var CursorCoord=SGWorld.Window.PixelToWorld(X,Y,-1153),altitudeMethod=void 0!==drawing.options.altitudeMethod?drawing.options.altitudeMethod:3,parentGroup=void 0!==drawing.options.parentGoupID?drawing.options.parentGoupID:SGWorld.ProjectTree.HiddenGroupID;if(null==drawing.polyObject){var myGeometry=SGWorld.Creator.GeometryCreator.CreateLineStringGeometry(new Array(CursorCoord.Position.X,CursorCoord.Position.Y,CursorCoord.Position.Altitude,CursorCoord.Position.X,CursorCoord.Position.Y,CursorCoord.Position.Altitude));drawing.polyObject=SGWorld.Creator.CreatePolyline(myGeometry,SGWorld.Creator.CreateColor(0,255,0,1),altitudeMethod,parentGroup,"polyline"),drawing_StylePoly(drawing.polyObject),drawing.polyObject.Geometry.StartEdit(),void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&(myGeometry=SGWorld.Creator.GeometryCreator.CreateLineStringGeometry([0,0,0,0,0,0]),drawing.helpLine=SGWorld.Creator.CreatePolyline(myGeometry,SGWorld.Creator.CreateColor(0,255,0,1),altitudeMethod,SGWorld.ProjectTree.HiddenGroupID,"helper"),drawing_StyleHelpLine(drawing.helpLine),drawing.helpLine.Geometry.StartEdit())}else if(2==drawing.drawingEditMode)if(1==drawing.polyObject.ObjectType){if(drawing.polyObject.Geometry.Points.Item(0).X==CursorCoord.Position.X&&drawing.polyObject.Geometry.Points.Item(0).Y==CursorCoord.Position.Y&&drawing.polyObject.Geometry.Points.Item(0).Z==CursorCoord.Position.Altitude)return;var x=drawing.polyObject.Geometry.Points.Item(0).X,y=drawing.polyObject.Geometry.Points.Item(0).Y,z=drawing.polyObject.Geometry.Points.Item(0).Z,myGeometry=(SGWorld.Creator.DeleteObject(drawing.polyObject.ID),void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&(CursorCoord.Position.Altitude=z),SGWorld.Creator.GeometryCreator.CreateLinearRingGeometry([x,y,z,CursorCoord.Position.X,CursorCoord.Position.Y,CursorCoord.Position.Altitude,CursorCoord.Position.X,CursorCoord.Position.Y,CursorCoord.Position.Altitude]));drawing.polyObject=SGWorld.Creator.CreatePolygon(myGeometry,SGWorld.Creator.CreateColor(0,255,0,1),SGWorld.Creator.CreateColor(0,255,0,.5),altitudeMethod,parentGroup,"polygon"),drawing_StylePoly(drawing.polyObject),drawing.polyObject.Geometry.StartEdit()}else drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).X=CursorCoord.Position.X,drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).Y=CursorCoord.Position.Y,drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).Z=CursorCoord.Position.Altitude,void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&(drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).Z=drawing.polyObject.Geometry.Rings.Item(0).Points.Item(0).Z),drawing.polyObject.Geometry.Rings.Item(0).Points.AddPoint(CursorCoord.Position.X,CursorCoord.Position.Y,CursorCoord.Position.Altitude);else drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).X=CursorCoord.Position.X,drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).Y=CursorCoord.Position.Y,drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).Z=CursorCoord.Position.Altitude,void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&(drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).Z=drawing.polyObject.Geometry.Points.Item(0).Z),drawing.polyObject.Geometry.Points.AddPoint(CursorCoord.Position.X,CursorCoord.Position.Y,CursorCoord.Position.Altitude);void 0!==drawing.options.onAddPoint&&drawing.options.onAddPoint(drawing.polyObject.Geometry,drawing.polyObject.ObjectType,drawing.polyObject.Position.AltitudeType),drawing.polyObject.SetParam(5440,1)}catch(err){gDebug&&alert("ToolsCommon -> drawing_DrawPolyLButtonClicked: "+err.message)}return!1}function drawing_StylePoly(poly){try{poly.LineStyle.Width=void 0!==drawing.options.style.lineWidth?-1*drawing.options.style.lineWidth:-2,poly.LineStyle.Color.FromHTMLColor(void 0!==drawing.options.style.lineColor?drawing.options.style.lineColor:"#ffffff"),poly.LineStyle.Color.SetAlpha(void 0!==drawing.options.style.lineOpacity?drawing.options.style.lineOpacity:1),poly.LineStyle.Pattern=void 0!==drawing.options.style.linePattern?drawing.options.style.linePattern:4294967295,poly.LineStyle.BackColor.FromHTMLColor(void 0!==drawing.options.style.lineBackColor?drawing.options.style.lineBackColor:"#000000"),poly.LineStyle.BackColor.SetAlpha(void 0!==drawing.options.style.lineBackOpacity?drawing.options.style.lineBackOpacity:0),poly.FillStyle.Color.FromHTMLColor(void 0!==drawing.options.style.fillColor?drawing.options.style.fillColor:"#ffffff"),poly.FillStyle.Color.SetAlpha(void 0!==drawing.options.style.fillOpacity?drawing.options.style.fillOpacity:0),poly.SaveInFlyFile=void 0!==drawing.options.saveOnExit&&drawing.options.saveOnExit}catch(err){gDebug&&alert("ToolsCommon -> drawing_StylePoly: "+err.message)}}function drawing_StyleHelpLine(poly){try{poly.LineStyle.Width=-2,poly.LineStyle.Color.FromHTMLColor("#ffff00"),poly.LineStyle.Pattern=2863311530,poly.SaveInFlyFile=!1}catch(err){gDebug&&alert("ToolsCommon -> drawing_StyleHelpLine: "+err.message)}}function drawing_DrawPolyOnFrame(){if(null!=drawing.polyObject)try{var mouseInfo=SGWorld.Window.GetMouseInfo(),CursorCoord=SGWorld.Window.PixelToWorld(mouseInfo.X,mouseInfo.Y,-1153);if(null==CursorCoord)return!1;2==drawing.polyObject.ObjectType?(drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).X=CursorCoord.Position.X,drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).Y=CursorCoord.Position.Y,drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).Z=CursorCoord.Position.Altitude,void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&(drawing.polyObject.Geometry.Rings.Item(0).Points.Item(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1).Z=drawing.polyObject.Geometry.Rings.Item(0).Points.Item(0).Z)):(drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).X=CursorCoord.Position.X,drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).Y=CursorCoord.Position.Y,drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).Z=CursorCoord.Position.Altitude,void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&(drawing.polyObject.Geometry.Points.Item(drawing.polyObject.Geometry.Points.Count-1).Z=drawing.polyObject.Geometry.Points.Item(0).Z)),drawing.polyObject.SetParam(5440,1),void 0!==drawing.options.horizontal&&1==drawing.options.horizontal&&null!=drawing.helpLine&&(drawing.helpLine.Geometry.Points.Item(0).X=CursorCoord.Position.X,drawing.helpLine.Geometry.Points.Item(0).Y=CursorCoord.Position.Y,drawing.helpLine.Geometry.Points.Item(0).Z=CursorCoord.Position.Altitude,drawing.helpLine.Geometry.Points.Item(1).X=CursorCoord.Position.X,drawing.helpLine.Geometry.Points.Item(1).Y=CursorCoord.Position.Y,drawing.helpLine.Geometry.Points.Item(1).Z=drawing.polyObject.Geometry.Points.Item(0).Z)}catch(e){}}function drawing_DrawPolyRButtonUp(Flags,X,Y){var deleteWhenExit=void 0===drawing.options.deleteWhenExit||drawing.options.deleteWhenExit;return null==drawing.polyObject||1==drawing.polyObject.ObjectType&&drawing.polyObject.Geometry.Points.Count<=2||2==drawing.polyObject.ObjectType&&drawing.polyObject.Geometry.Rings.Item(0).Points.Count<=3?(drawing_finishDrawing(deleteWhenExit),!1):(1==drawing.polyObject.ObjectType?drawing.polyObject.Geometry.Points.DeletePoint(drawing.polyObject.Geometry.Points.Count-1):drawing.polyObject.Geometry.Rings.Item(0).Points.DeletePoint(drawing.polyObject.Geometry.Rings.Item(0).Points.Count-1),drawing.polyObject.Geometry.EndEdit(),drawing.options.onFinish(drawing.polyObject.Geometry,drawing.polyObject.ObjectType,drawing.polyObject.Position.AltitudeType,drawing.polyObject.ID,null),drawing_finishDrawing(deleteWhenExit),!0)}function searchGeometries2(parentNode,callbackFunc,withAtt){SGWorld.ProjectTree.EnableRedraw(0),searchGeometriesLeaf2(parentNode,callbackFunc,withAtt),SGWorld.ProjectTree.EnableRedraw(1)}function searchGeometriesLeaf2(parentNode,callbackFunc,withAtt){if(SGWorld.ProjectTree.IsLayer(parentNode))for(var layer=SGWorld.ProjectTree.GetLayer(parentNode),featureGroups=layer.FeatureGroups,i=0;i<featureGroups.Count;i++)for(var featureGroup=featureGroups.Item(i),altitudeType=AltitudeMethodToAltitudeType(featureGroup.GetProperty("Altitude Method")),features=featureGroup.Features,attributes=layer.DataSourceInfo.Attributes,j=0;j<features.Count;j++){if(0!=featureGroup.GeometryType)if(5==features.Item(j).Geometry.GeometryType||6==features.Item(j).Geometry.GeometryType)for(var k=0;k<features.Item(j).Geometry.Count;k++)ret=callbackFunc(features.Item(j).Geometry.Item(k),featureGroup.GeometryType,altitudeType,features(j),attributes);else ret=callbackFunc(features.Item(j).Geometry,featureGroup.GeometryType,altitudeType,features(j),attributes);else 0==features.Item(j).Geometry.GeometryType&&(ret=callbackFunc(SGWorld.Creator.CreatePosition(features.Item(j).Geometry.X,features.Item(j).Geometry.Y,features.Item(j).Geometry.Z),featureGroup.GeometryType,altitudeType));if(!ret)return}else for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){if(SGWorld.ProjectTree.IsGroup(node)||SGWorld.ProjectTree.IsLayer(node))searchGeometriesLeaf2(node,callbackFunc);else{var Object=SGWorld.Creator.GetObject(node);if(null!=Object){var ret,altitudeType=Object.Position.AltitudeType;if(1==Object.ObjectType||2==Object.ObjectType)if(5==Object.Geometry.GeometryType||6==Object.Geometry.GeometryType)for(j=0;j<Object.Geometry.Count;j++)ret=callbackFunc(Object.Geometry.Item(j),Object.ObjectType,altitudeType,Object.Position);else ret=callbackFunc(Object.Geometry,Object.ObjectType,altitudeType,Object.Position);else ret=callbackFunc(Object.Position,Object.ObjectType,altitudeType,Object.Position);if(!ret)return}}node=SGWorld.ProjectTree.GetNextItem(node,13)}}function AltitudeMethodToAltitudeType(altitudeMethod){switch(altitudeMethod){case 10:return AltitudeTypeCode.ATC_TERRAIN_RELATIVE;case 11:return AltitudeTypeCode.ATC_TERRAIN_ABSOLUTE;case 12:return AltitudeTypeCode.ATC_ON_TERRAIN;case 13:return AltitudeTypeCode.ATC_PIVOT_RELATIVE}}function searchGeometriesClipboard(callbackFunc){SGWorld.ProjectTree.EnableRedraw(0);for(var i=0;i<SGWorld.Application.Clipboard.Count;i++)try{var Object,ret,altitudeType=(Object=SGWorld.Application.Clipboard.Item(i)).Position.AltitudeType;if(1==Object.ObjectType||2==Object.ObjectType)if(5==Object.Geometry.GeometryType||6==Object.Geometry.GeometryType)for(var j=0;j<Object.Geometry.Count;j++)ret=callbackFunc(Object.Geometry.Item(j),Object.ObjectType,altitudeType,Object.Position,null,null);else ret=callbackFunc(Object.Geometry,Object.ObjectType,altitudeType,Object.Position,null,null);else ret=callbackFunc(Object.Position,Object.ObjectType,altitudeType,Object.Position,null,null);if(!ret)return void SGWorld.ProjectTree.EnableRedraw(1)}catch(e){}SGWorld.ProjectTree.EnableRedraw(1)}function ShallowCopyForIE(inputObject,copiedObject){for(var key in inputObject)inputObject.hasOwnProperty(key)&&(copiedObject[key]=inputObject[key]);return copiedObject}function getElevationBuffer(geometry,resolution){try{var envelope=geometry.Clone().Envelope,MinX=Math.min(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),MaxX=Math.max(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),MinY=Math.min(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),MaxY=Math.max(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),stepX=Math.abs(MaxX-MinX)/resolution,stepY=Math.abs(MaxY-MinY)/resolution;return TEF?SGWorld.Analysis.QueryElevationBuffer(MinX,MaxY,stepX,stepY,resolution,resolution):SGWorld.Analysis.QueryElevationBuffer(MinX,MaxY,stepX,stepY,resolution,resolution).toArray()}catch(e){return null}}function geometryToElevationParam(geometry,resolution){try{var envelope=geometry.Clone().Envelope,minX=Math.min(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),maxX=Math.max(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),minY=Math.min(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),maxY=Math.max(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y);return{minX:minX,maxY:maxY,stepX:Math.abs(maxX-minX)/resolution,stepY:Math.abs(maxY-minY)/resolution}}catch(e){return null}}function rectangleGeometryToElevationParams(geometry){try{var envelope=geometry.Clone().Envelope,minX=Math.min(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),maxX=Math.max(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),minY=Math.min(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),maxY=Math.max(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),resX=Math.abs(maxX-minX)/1024,resY=Math.abs(maxY-minY)/1024;return{asyncQueryObj:SGWorld.Analysis.QueryElevationBufferAsync(minX,maxY,resX,resY,1024,1024),minX:minX,maxY:maxY,resX:resX,resY:resY,dimensionXInPixels:1024,dimensionYInPixels:1024}}catch(err){gDebug&&alert("ToolsCommon -> rectangleGeometryToElevationParams: "+err.message)}}function getElevationInfo(geometry){try{var envelope=geometry.Clone().Envelope,minX=Math.min(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),maxX=Math.max(envelope.Rings.Item(0).Points.Item(0).X,envelope.Rings.Item(0).Points.Item(2).X),minY=Math.min(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),maxY=Math.max(envelope.Rings.Item(0).Points.Item(0).Y,envelope.Rings.Item(0).Points.Item(2).Y),bottomLeft=SGWorld.Creator.CreatePosition(minX,minY,0,3,0,0,0,0),topLeft=SGWorld.Creator.CreatePosition(maxX,minY,0,3,0,0,0,0),topRight=SGWorld.Creator.CreatePosition(maxX,maxY,0,3,0,0,0,0),widthMeters=topLeft.DistanceTo(topRight),heightMeters=bottomLeft.DistanceTo(topLeft),VSLengthMeters=Math.min(widthMeters,heightMeters),maxQueryDimension=1024,numOfXQuerysNeeded=(5e3<VSLengthMeters&&(maxQueryDimension=1500),Math.ceil(widthMeters/maxQueryDimension)),numOfYQuerysNeeded=Math.ceil(heightMeters/maxQueryDimension),resXMeters=widthMeters/numOfXQuerysNeeded/1024,resYMeters=heightMeters/numOfYQuerysNeeded/1024;return{minX:minX,maxX:maxX,minY:minY,maxY:maxY,resX:Math.abs(maxX-minX)/numOfXQuerysNeeded/1024,resY:Math.abs(maxY-minY)/numOfYQuerysNeeded/1024,resXMeters:resXMeters,resYMeters:resYMeters,dimensionXInPixels:1024,dimensionYInPixels:1024,numOfXQuerysNeeded:numOfXQuerysNeeded,numOfYQuerysNeeded:numOfYQuerysNeeded}}catch(e){gDebug&&alert("ToolsCommon -> getElevationInfo: "+e.message),OnRejectCallback(e)}}function rectangleGeometryToMultipleElevationParams(geometry,OnResolveCallback,OnProgressCallback,OnRejectCallback){try{var queryParams=getElevationInfo(geometry),queryParamsCopy={};ShallowCopyForIE(queryParams,queryParamsCopy),GetMatrixOfBuffersRec(queryParams,queryParamsCopy,0,0,OnResolveCallback,OnProgressCallback,OnRejectCallback,[])}catch(e){gDebug&&alert("ToolsCommon -> rectangleGeometryToMultipleElevationParams: "+e.message),OnRejectCallback(e)}}function GetMatrixOfBuffers(queryParams){for(var matrixOfBuffers=[],i=0;i<queryParams.numOfYQuerysNeeded;i++){var queryParamsCopy={};ShallowCopyForIE(queryParamsCopy,queryParams),queryParamsCopy.maxY-=queryParamsCopy.resY*queryParamsCopy.dimensionYInPixels*i,matrixOfBuffers[i]=GetRowOfBuffers(queryParamsCopy,0,0,callBack)}return matrixOfBuffers}function GetMatrixOfBuffersRec(generalQueryParams,currentQueryParams,row,col,OnResolveCallback,OnProgressCallback,OnRejectCallback,matrixOfBuffers){try{row==currentQueryParams.numOfYQuerysNeeded-1&&col==currentQueryParams.numOfXQuerysNeeded?ReduceMatrixOfBuffersToSingleFlatBuffer(matrixOfBuffers,generalQueryParams,OnResolveCallback,OnProgressCallback,OnRejectCallback):col==currentQueryParams.numOfXQuerysNeeded?(currentQueryParams.minX=generalQueryParams.minX,currentQueryParams.maxY-=currentQueryParams.resY*currentQueryParams.dimensionYInPixels,GetMatrixOfBuffersRec(generalQueryParams,currentQueryParams,++row,0,OnResolveCallback,OnProgressCallback,OnRejectCallback,matrixOfBuffers)):SGWorld.Analysis.QueryElevationBufferAsync(currentQueryParams.minX,currentQueryParams.maxY,currentQueryParams.resX,currentQueryParams.resY,currentQueryParams.dimensionXInPixels,currentQueryParams.dimensionYInPixels).OnResolve(function(buffer){TEF||(buffer=buffer.toArray()),0==col&&matrixOfBuffers.push([]),matrixOfBuffers[row].push(buffer),currentQueryParams.minX+=currentQueryParams.resX*currentQueryParams.dimensionXInPixels,setTimeout(function(){GetMatrixOfBuffersRec(generalQueryParams,currentQueryParams,row,++col,OnResolveCallback,OnProgressCallback,OnRejectCallback,matrixOfBuffers)},1)}).OnProgress(function(progress){var totalNumQuerys=generalQueryParams.numOfXQuerysNeeded*generalQueryParams.numOfYQuerysNeeded,numOfQuerysLeftToPerform=generalQueryParams.numOfXQuerysNeeded*generalQueryParams.numOfYQuerysNeeded-(generalQueryParams.numOfXQuerysNeeded*row+col);OnProgressCallback(100*(totalNumQuerys-numOfQuerysLeftToPerform)/totalNumQuerys,"primary"),OnProgressCallback(progress,"secondary")}).OnReject(function(error){setTimeout(function(){GetMatrixOfBuffersRec(generalQueryParams,currentQueryParams,row,col,OnResolveCallback,OnProgressCallback,OnRejectCallback,matrixOfBuffers)},1)})}catch(err){gDebug&&alert("ToolsCommon -> GetMatrixOfBuffersRec: "+err.message),OnRejectCallback(err)}}function GetRowOfBuffers(queryParams){try{var queryParamsForReq,rowOfBuffersRec,buffer;return 1==queryParams.numOfXQuerysNeeded?(buffer=SGWorld.Analysis.QueryElevationBuffer(queryParams.minX,queryParams.maxY,queryParams.resX,queryParams.resY,queryParams.dimensionXInPixels,queryParams.dimensionYInPixels),[buffer=TEF?buffer:buffer.toArray()]):(ShallowCopyForIE(queryParamsForReq={},queryParams),queryParamsForReq.minX+=queryParamsForReq.resX*queryParamsForReq.dimensionXInPixels,--queryParamsForReq.numOfXQuerysNeeded,rowOfBuffersRec=GetRowOfBuffers(queryParamsForReq),buffer=SGWorld.Analysis.QueryElevationBuffer(queryParams.minX,queryParams.maxY,queryParams.resX,queryParams.resY,queryParams.dimensionXInPixels,queryParams.dimensionYInPixels),TEF||(buffer=buffer.toArray()),rowOfBuffersRec.unshift(buffer),rowOfBuffersRec)}catch(err){gDebug&&alert("ToolsCommon -> GetRowOfBuffers: "+err.message)}}function ReduceMatrixOfBuffersToSingleFlatBuffer(matrix,queryParams,OnResolveCallback,OnProgressCallback,OnRejectCallback){try{for(var indexInBuffer,val,size=4*queryParams.dimensionYInPixels*queryParams.dimensionXInPixels*matrix.length*matrix[0].length,buffer=new ArrayBuffer(size),flatBuffer=new Float32Array(buffer),v=0,row=0;row<matrix.length;row++)for(var pixelCol=0;pixelCol<queryParams.dimensionYInPixels;pixelCol++)for(var indexOfBufferInRow=0;indexOfBufferInRow<matrix[row].length;indexOfBufferInRow++)for(var indexOfPixelInRow=0;indexOfPixelInRow<queryParams.dimensionXInPixels;indexOfPixelInRow++){indexInBuffer=pixelCol*queryParams.dimensionXInPixels+indexOfPixelInRow,val=matrix[row][indexOfBufferInRow][indexInBuffer];try{flatBuffer[v]=val}catch(err){}v++}matrix=null,queryParams.buffer=flatBuffer,OnResolveCallback(queryParams)}catch(e){OnRejectCallback(e)}}function BuildObjectsList(parentNode,list,objectType){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){if(SGWorld.ProjectTree.IsLayer(node))36==objectType&&list.push(node);else{try{var Object=SGWorld.Creator.GetObject(node);null!=Object&&Object.ObjectType==objectType&&list.push(Object.ID)}catch(err){}SGWorld.ProjectTree.IsGroup(node)&&BuildObjectsList(node,list,objectType)}node=SGWorld.ProjectTree.GetNextItem(node,13)}}catch(err){gDebug&&alert("ToolsCommon -> BuildObjectsList: "+err.message)}}function BuildMultipleObjectsTypesList(parentNode,list,objectType){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;){try{var Object=SGWorld.Creator.GetObject(node);if(null!=Object)if(Array.isArray(objectType))for(var i=0;i<objectType.length;i++)Object.ObjectType==objectType[i]&&list.push(Object.ID);else Object.ObjectType==objectType&&list.push(Object.ID)}catch(err){}SGWorld.ProjectTree.IsGroup(node)&&BuildMultipleObjectsTypesList(node,list,objectType),node=SGWorld.ProjectTree.GetNextItem(node,13)}}catch(err){gDebug&&alert("ToolsCommon80.js -> BuildMultipleObjectsTypesList: "+err.message)}}function BuildFoldersList(parentNode,list){try{for(var node=SGWorld.ProjectTree.GetNextItem(parentNode,11);""!=node;)SGWorld.ProjectTree.IsGroup(node)&&(list.push(node),BuildFoldersList(node,list)),node=SGWorld.ProjectTree.GetNextItem(node,13)}catch(err){gDebug&&alert("ToolsCommon80 -> BuildFoldersList: "+err.message)}}function getFuncName(callee){return callee.toString().match(/^function\s+([^(]+)/)[1]}function Deg2Rnd(degrees){return degrees*(Math.PI/180)}