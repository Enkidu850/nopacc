var SeverityColors=["#FFE99F","#00FF00","#FFD800","#FF6A00","#FF0000","#B200FF"],debug=!0;function initReport(){try{setTimeout(function(){for(var i=0;i<photos.length;i++)initPhotoViewer(i)},0)}catch(err){}}function initPhotoViewer(i){try{var tilesetURL={},tilesetURL=0<=photos[i].photo[photos[i].photoIndex].indexOf("http")?0<=photos[i].photo[photos[i].photoIndex].indexOf(".smpt")||0<=photos[i].photo[photos[i].photoIndex].indexOf(".SMPT")?{height:parseInt(photos[i].Height[photos[i].photoIndex]),width:parseInt(photos[i].Width[photos[i].photoIndex]),tileSize:256,minLevel:8,getTileUrl:function(level,x,y){return photos[i].photo[photos[i].photoIndex]+"?level="+level+"&x="+x+"&y="+y}}:{type:"image",url:photos[i].photo[photos[i].photoIndex],buildPyramid:!1}:0<=photos[i].photo[photos[i].photoIndex].indexOf(".smpt")||0<=photos[i].photo[photos[i].photoIndex].indexOf(".SMPT")?{height:parseInt(photos[i].Height[photos[i].photoIndex]),width:parseInt(photos[i].Width[photos[i].photoIndex]),tileSize:256,minLevel:0,getTileUrl:function(level,x,y){return"skyline:smpt."+photos[i].photo[photos[i].photoIndex]+"?level="+level+"&x="+x+"&y="+y}}:{type:"image",url:photos[i].photo[photos[i].photoIndex],buildPyramid:!1};photos[i].viewer=OpenSeadragon({id:"PhotoViewerDiv-"+i,prefixUrl:abspath+"/../jquery/openseadragon-bin-2.4.2/images/",sequenceMode:!0,tileSources:tilesetURL,maxZoomPixelRatio:1,showRotationControl:!0,showNavigator:!1}),photos[i].viewer.addHandler("open",function(event){ZoomToPixel(event.userData.index),drawoverlays(event.userData.index)},{index:i}),$("#photoURL"+i).html(photos[i].photo[photos[i].photoIndex])}catch(err){debug&&alert("report.js -> initPhotoViewer: "+err.message)}}function PrevNextPhoto(index,step){photos[index].photoIndex=Math.max(Math.min(photos[index].photoIndex+step,photos[index].maxPhotos-1),0),photos[index].viewer.clearOverlays(),photos[index].viewer.destroy(),photos[index].overlay=null,initPhotoViewer(index)}function ZoomToPixel(index){var viewer=photos[index].viewer,index=viewer.viewport.imageToViewportCoordinates(photos[index].centerPixel[photos[index].photoIndex][0],photos[index].centerPixel[photos[index].photoIndex][1]);viewer.viewport.zoomTo(1),viewer.viewport.panTo(index,!0)}function drawoverlays(index){try{var viewer=photos[index].viewer,inspectionPoint=viewer.viewport.imageToViewportCoordinates(photos[index].annotation[photos[index].photoIndex][0],photos[index].annotation[photos[index].photoIndex][1]),drawID="inspectionDraw-"+Math.floor(1e4*Math.random()+1).toString(),featureIndex=photos[index].Index,severity=photos[index].Severity,DistanceValue=photos[index].Description;isNativeInspectionLayer?0==severity?$("#PhotoViewerDiv-"+index).append('<div id="'+drawID+"\"> <span class='distance'>"+DistanceValue+"</span></div>"):$("#PhotoViewerDiv-"+index).append("<div style='position:relative' id=\""+drawID+"\"> <img src='"+abspath+"/images/Severity"+severity+".png' ><span class='annotation' style='position:absolute; left:0px; top:0px;left:50%;top:50%;transform: translate(-50%,-75%);'>"+featureIndex+"</span> </div>"):$("#PhotoViewerDiv-"+index).append('<div id="'+drawID+"\"> <span class='distance'></span></div>"),viewer.addOverlay(drawID,inspectionPoint,OpenSeadragon.Placement.BOTTOM),photos[index].CanvasOverlay=viewer.canvasOverlay({onRedraw:function(){try{var ctx=photos[index].CanvasOverlay.context2d();if(ctx.lineWidth=.003,ctx.setLineDash([5,13]),ctx.beginPath(),photos[index].isMultipolygon||photos[index].isMultipolyline)for(j=0;j<photos[index].overlays[photos[index].photoIndex].length;j++)for(var i=0;i<photos[index].overlays[photos[index].photoIndex][j].length;i++){var waypointPoint=viewer.viewport.imageToViewportCoordinates(photos[index].overlays[photos[index].photoIndex][j][i][0],photos[index].overlays[photos[index].photoIndex][j][i][1]);0==i?ctx.moveTo(waypointPoint.x,waypointPoint.y):ctx.lineTo(waypointPoint.x,waypointPoint.y)}else for(j=0;j<photos[index].overlays[photos[index].photoIndex].length;j++){waypointPoint=viewer.viewport.imageToViewportCoordinates(photos[index].overlays[photos[index].photoIndex][j][0],photos[index].overlays[photos[index].photoIndex][j][1]);0==j?ctx.moveTo(waypointPoint.x,waypointPoint.y):ctx.lineTo(waypointPoint.x,waypointPoint.y)}photos[index].IsExternalLayer?ctx.strokeStyle=SeverityColors[severity]:ctx.strokeStyle=photos[index].LineColor,ctx.fillStyle="transparent",ctx.stroke()}catch(err){}}}),$(window).resize(function(){null!=photos[index].CanvasOverlay&&photos[index].CanvasOverlay.resize()})}catch(err){}}