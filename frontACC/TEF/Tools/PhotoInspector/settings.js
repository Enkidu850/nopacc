var settings={params:{TileStreaming:!0,cameraSymbolSize:1,showProjector:0,searchDistance:1e3,multipleViewers:!1,secondaryViewerType:0,secondaryAttach:!1,maxResultPerSide:10,virtualCursor:1,edgeBuffer:50,maxInspectionsOnPhoto:10,measurementUnit:0,measurementSaveMode:1,InspectionDrawMode:0,meshModelID:"",meshModelName:"",BIMModelID:"",BIMModelName:"",lineWidth:.0015,projectName:"",projectDescription:"",createdFor:"",author:"",SMPTAlternativePath:""},NeedRefreshViewers:!1,MatchUIAccordingToPublishedOrLocalProject:function(){try{0!=application.photosLayer.DataSourceInfo.Attributes.IsAttributeExist("das_userfilename")&&$("#FixPhotoPathButtonID").prop("disabled",!0)}catch(err){application.debug&&alert("settings.js -> MatchUIAccordingToPublishedOrLocalProject: "+err.message)}},MatchUIWithInspectionLayerType:function(){try{1==inspections.inspectionLayer.GeometryType&&inspections.inspectionLayer.DataSourceInfo.Attributes.IsAttributeExist("severity")?(this.params.InspectionDrawMode=0,inspections.PartlyEnableToolboxButtons(1)):1==inspections.inspectionLayer.GeometryType?(this.params.InspectionDrawMode=0,inspections.PartlyEnableToolboxButtons(2)):2==inspections.inspectionLayer.GeometryType&&(this.params.InspectionDrawMode=3,inspections.PartlyEnableToolboxButtons(0))}catch(err){application.debug&&alert(err.message)}},Init:function(){this.params.SMPTAlternativePath=application.getDefaultSMPTFolderPath(),this.ReadSettings(),this.MatchUIAccordingToPublishedOrLocalProject()},ReadSettings:function(){try{var clientDataJson=application.photosLayer.GetClientData("PhotoInspector"),clientData=clientDataJson?JSON.parse(clientDataJson):{};$("#iconSizeID").val((clientData&&clientData.cameraSymbolSize?clientData:this.params).cameraSymbolSize),$("#showProjectorID").val((clientData&&clientData.showProjector?clientData:this.params).showProjector),$("#searchDistanceID").val((clientData&&clientData.searchDistance?clientData:this.params).searchDistance),$("#MultipleViewersSelectionID").prop("checked",(clientData&&clientData.multipleViewers?clientData:this.params).multipleViewers),$("#SecondaryViewerTypeID").val((clientData&&clientData.secondaryViewerType?clientData:this.params).secondaryViewerType),$("#SecondaryAttachID").prop("checked",(clientData&&clientData.secondaryAttach?clientData:this.params).secondaryAttach),$("#TileStreamingID").prop("checked",(clientData&&""!==clientData.TileStreaming&&null!==clientData.TileStreaming&&void 0!==clientData.TileStreaming?clientData:this.params).TileStreaming),$("#SMPTFolderPathID").val((clientData&&clientData.SMPTAlternativePath?clientData:this.params).SMPTAlternativePath),$("#maxResultsID").val((clientData&&clientData.maxResultPerSide?clientData:this.params).maxResultPerSide),$("#maxInspectionsOnPhotoID").val((clientData&&clientData.maxInspectionsOnPhoto?clientData:this.params).maxInspectionsOnPhoto),$("#InspectionDrawModeID").val((clientData&&clientData.InspectionDrawMode?clientData:this.params).InspectionDrawMode),$("#LineWidthID").val((clientData&&clientData.lineWidth?clientData:this.params).lineWidth),$("#MeasurementUnitID").val((clientData&&clientData.measurementUnit?clientData:this.params).measurementUnit),$("#MeasurementSaveModeID").val((clientData&&clientData.measurementSaveMode?clientData:this.params).measurementSaveMode),this.params.meshModelID=(clientData&&clientData.meshModelID?clientData:this.params).meshModelID,this.params.meshModelName=(clientData&&clientData.meshModelName?clientData:this.params).meshModelName,$("#MeshModelName").text(this.params.meshModelName),this.params.BIMModelID=(clientData&&clientData.BIMModelID?clientData:this.params).BIMModelID,this.params.BIMModelName=(clientData&&clientData.BIMModelName?clientData:this.params).BIMModelName,$("#BIMModelName").text(this.params.BIMModelName),$("#BIMModelName").text((clientData&&clientData.BIMModelName?clientData:this.params).BIMModelName),$("#projectNameID").val((clientData&&clientData.projectName?clientData:this.params).projectName),$("#projectDescriptionID").val((clientData&&clientData.projectDescription?clientData:this.params).projectDescription),$("#createdForID").val((clientData&&clientData.createdFor?clientData:this.params).createdFor),$("#authorID").val((clientData&&clientData.author?clientData:this.params).author),this.SaveSettings(),this.changeMultipleViewersToolbox(!1)}catch(err){application.debug&&alert(err.message)}},SaveSettings:function(){try{this.LockTileStreamingCheckboxInPublishedProjects(),this.params.SMPTAlternativePath=$("#SMPTFolderPathID").val(),this.params.InspectionsTransparency=$("#InspectionsTransparencyID").val(),this.params.cameraSymbolSize=$("#iconSizeID").val(),this.params.showProjector=$("#showProjectorID").val(),this.params.searchDistance=$("#searchDistanceID").val(),this.params.multipleViewers=$("#MultipleViewersSelectionID").is(":checked"),this.params.secondaryViewerType=$("#SecondaryViewerTypeID").val(),this.params.secondaryAttach=$("#SecondaryAttachID").is(":checked"),this.params.maxResultPerSide=$("#maxResultsID").val(),this.params.maxInspectionsOnPhoto=$("#maxInspectionsOnPhotoID").val(),this.params.InspectionDrawMode=$("#InspectionDrawModeID").val(),this.params.lineWidth=$("#LineWidthID").val(),this.params.measurementUnit=$("#MeasurementUnitID").val(),this.params.measurementSaveMode=$("#MeasurementSaveModeID").val(),this.params.projectName=$("#projectNameID").val(),this.params.projectDescription=$("#projectDescriptionID").val(),this.params.createdFor=$("#createdForID").val(),this.params.author=$("#authorID").val(),application.photosLayer.SetClientData("PhotoInspector",JSON.stringify(this.params))}catch(err){application.debug&&alert("settings.js -> SaveSettings: "+err.message)}},LockTileStreamingCheckboxInPublishedProjects:function(){try{var nullGeo;0==application.photosLayer.DataSourceInfo.Attributes.IsAttributeExist("das_userfilename")?this.params.TileStreaming=$("#TileStreamingID").is(":checked"):(nullGeo=SGWorld.Creator.GeometryCreator.CreatePolygonGeometry(null),application.photosLayer.ExecuteQueryAsync("",1,"",nullGeo).OnResolve(function(features){0==features.Count?alert(SGLang.i18n("EmptyPhotoLayer")):(features=features.Item(0),-1==(features=String(features.GetProperty("UserFileName"))).indexOf("SMPT")&&-1==features.indexOf("smpt")?$("#TileStreamingID").prop("checked",!1):$("#TileStreamingID").prop("checked",!0),$("#TileStreamingID").addClass("locked"),$("#TileStreamingID").prop("disabled",!0))}).OnReject(function(error){application.debug&&alert("settings.js -> LockTileStreamingCheckboxInPublishedProjects: OnReject"+err.message)}))}catch(err){application.debug&&alert("settings.js -> LockTileStreamingCheckboxInPublishedProjects: "+err.message)}},ShowSettings:function(show){show?($("#SettingsDiv").show(),application.zIndex++,$("#SettingsDiv").css("z-index",application.zIndex),inspections.populateInspectionLayerList($("#InspectionListID"),!1),this.ShowFixPhotosURL(!1),this.ShowCreateInspectionLayer(!1),this.NeedRefreshViewers=!1):(this.SaveSettings(),this.changeMultipleViewersToolbox(!1),$("#SettingsDiv").hide(),this.NeedRefreshViewers&&application.RefreshViewers())},changeMultipleViewersToolbox:function(switchMode){1!=inspections.DrawMode&&2!=inspections.DrawMode&&(switchMode&&(this.params.multipleViewers=!this.params.multipleViewers,application.RefreshViewers(),$("#MultipleViewersSelectionID").prop("checked",this.params.multipleViewers),this.SaveSettings()),switchMode=this.params.multipleViewers?"images/twoViewers.png":"images/singleViewer.png",$("#toolMultipleViewers").attr("src",switchMode))},ShowFixURL:function(show){try{show?settings.params.TileStreaming?this.ShowFixSMPTsURL(!0):this.ShowFixPhotosURL(!0):settings.params.TileStreaming?this.ShowFixSMPTsURL(!1):this.ShowFixPhotosURL(!1)}catch(err){application.debug&&alert("settings.js -> ShowFixURL: "+err.message)}},ShowFixSMPTsURL:function(show){try{show?($("#FixSMPTsURLDiv").show(),application.zIndex++,$("#FixSMPTsURLDiv").css("z-index",application.zIndex),$("#SMPTFolderPathID").val(this.params.SMPTAlternativePath)):$("#FixSMPTsURLDiv").hide()}catch(err){application.debug&&alert("settings.js -> ShowFixSMPTsURL: "+err.message),alert(SGLang.i18n("TextFixError")),this.ShowFixSMPTsURL(!1)}},ShowFixPhotosURL:function(show){try{var photoName,len;show?($("#FixPhotosURLDiv").show(),application.zIndex++,$("#FixPhotosURLDiv").css("z-index",application.zIndex),photoName=application.photosLayer.FeatureGroups.Point.GetCurrentFeatures().Item(0).FeatureAttributes.GetFeatureAttribute("path").Value,0==(len=Math.max(photoName.lastIndexOf("\\"),photoName.lastIndexOf("/")))&&(len=photoName.length),photoName=photoName.substr(0,len),$("#findURLID").val(photoName),$("#replaceURLID").val(photoName)):$("#FixPhotosURLDiv").hide()}catch(err){application.debug&&alert("settings.js -> ShowFixPhotosURL: "+err.message),alert(SGLang.i18n("TextFixError")),this.ShowFixPhotosURL(!1)}},fixPhotosURL:function(){try{var findText=$("#findURLID").val(),replaceText=$("#replaceURLID").val(),geo=SGWorld.Creator.GeometryCreator.CreatePolygonGeometry(lineString);application.photosLayer.ExecuteQueryAsync("",-1,"",geo).OnResolve(function(features){for(var i=0;i<features.Count;i++){var photoName=(photoName=features.Item(i).FeatureAttributes.GetFeatureAttribute("path").Value).replace(findText,replaceText);features.Item(i).FeatureAttributes.GetFeatureAttribute("path").Value=photoName}application.photosLayer.save(),alert(SGLang.i18n("TextFixPhotoURLFinished")),this.ShowFixPhotosURL(!1)}).OnReject(function(error){alert(SGLang.i18n("TextFixError")+err.message),this.ShowFixPhotosURL(!1)})}catch(err){alert(SGLang.i18n("TextFixError")+err.message),this.ShowFixPhotosURL(!1)}},FixSMPTsURL:function(){try{this.params.SMPTAlternativePath=$("#SMPTFolderPathID").val(),this.SaveSettings(),alert(SGLang.i18n("TextFixSMPTURLFinished"))}catch(err){application.debug&&alert("settings.js -> FixSMPTsURL: "+err.message)}},ResetSMPTsURL:function(){var smptFolderPath=application.getDefaultSMPTFolderPath();$("#SMPTFolderPathID").val(smptFolderPath),this.SaveSettings()},ShowCreateInspectionLayer:function(show){show?($("#createInspectionLayerDiv").show(),application.zIndex++,$("#createInspectionLayerDiv").css("z-index",application.zIndex)):$("#createInspectionLayerDiv").hide()},changeIconSize:function(){this.params.cameraSymbolSize=$("#iconSizeID").val(),application.photosLayer.FeatureGroups.Point.SetProperty("Scale X",this.params.cameraSymbolSize),application.photosLayer.FeatureGroups.Point.SetProperty("Scale Y",1.5*this.params.cameraSymbolSize),application.photosLayer.FeatureGroups.Point.SetProperty("Scale Z",this.params.cameraSymbolSize)},captureMesh:function(capture){try{if(capture){var layerID=SGWorld.ProjectTree.GetNextItem("",10),layer=SGWorld.Creator.GetObject(layerID);if(null==layer||38!=layer.ObjectType)return void alert(SGLang.i18n("TextSettingsSelectMesh"));this.params.meshModelID=layerID,this.params.meshModelName=SGWorld.ProjectTree.GetItemName(layerID)}else this.params.meshModelID="",this.params.meshModelName="";$("#MeshModelName").text(this.params.meshModelName),this.SaveSettings()}catch(err){this.params.meshModelID="",this.params.meshModelName=""}},captureBIM:function(capture){try{if(capture){var layerID=SGWorld.ProjectTree.GetNextItem("",10),layer=SGWorld.Creator.GetObject(layerID);if(null==layer||38!=layer.ObjectType||""==SGWorld.ProjectTree.GetNextItem(layerID,11))return void alert(SGLang.i18n("TextSettingsSelectBIM"));this.params.BIMModelID=layerID,this.params.BIMModelName=SGWorld.ProjectTree.GetItemName(layerID)}else this.params.BIMModelID="",this.params.BIMModelName="";$("#BIMModelName").text(this.params.BIMModelName),this.SaveSettings()}catch(err){this.params.BIMModelID="",this.params.BIMModelName=""}},dummy:null};